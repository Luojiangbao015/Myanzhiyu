<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>Gdextension | 凝雨个人博客</title><meta name="keywords" content="学习"><meta name="author" content="凝雨"><meta name="copyright" content="凝雨"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="Gdextension"><meta name="application-name" content="Gdextension"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="Gdextension"><meta property="og:url" content="http://example.com/2025/03/15/%E6%88%88%E5%A4%9A/GDScript/Gdextension/index.html"><meta property="og:site_name" content="凝雨个人博客"><meta property="og:description" content="源码模板123456789101112131415161718192021222324#ifndef THREEN_H#define THREEN_H#include &amp;lt;godot_cpp&amp;#x2F;classes&amp;#x2F;node.hpp&amp;gt;&amp;#x2F;&amp;#x2F;#include &amp;lt;godot_cpp&amp;#x2F;core&amp;#x2F;cl"><meta property="og:locale" content="en"><meta property="og:image" content="http://example.com/img/ww/D003.png"><meta property="article:author" content="凝雨"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://example.com/img/ww/D003.png"><meta name="description" content="源码模板123456789101112131415161718192021222324#ifndef THREEN_H#define THREEN_H#include &amp;lt;godot_cpp&amp;#x2F;classes&amp;#x2F;node.hpp&amp;gt;&amp;#x2F;&amp;#x2F;#include &amp;lt;godot_cpp&amp;#x2F;core&amp;#x2F;cl"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://example.com/2025/03/15/%E6%88%88%E5%A4%9A/GDScript/Gdextension/"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: {"enable":true,"title":"与数百名博主无限进步","addFriendPlaceholder":"昵称（请勿包含博客等字样）：\n网站地址（要求博客地址，请勿提交个人主页）：\n头像图片url（请提供尽可能清晰的图片，我会上传到我自己的图床）：\n描述：\n站点截图（可选）：\n"},
  peoplecanvas: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"tianli","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":3},
  friends_vue_info: {"apiurl":"https://friends.anheyu.com/"},
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":["🤖️ 数码科技爱好者","🔍 分享与热心帮助","🏠 智能家居小能手","🔨 设计开发一条龙","🤝 专修交互与设计","🏃 脚踏实地行动派","🧱 团队小组发动机","💢 壮汉人狠话不多"]},
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: 'days',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"Author: 凝雨","link":"Link: ","source":"Source: 凝雨个人博客","info":"Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source.","copySuccess":"Copy success, copy and reprint please mark the address of this article"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"Traditional Chinese Activated Manually","cht_to_chs":"Simplified Chinese Activated Manually","day_to_night":"Dark Mode Activated Manually","night_to_day":"Light Mode Activated Manually","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: '凝雨个人博客',
  title: 'Gdextension',
  postAI: '',
  pageFillDescription: '源码, 模板, _bind_methods(), 注册属性, 声明枚举Flag常量, 信号, 数组, 实例对象, 调用单例, 重写虚函数, ADD_PROPERTY的用法, enum PropertyHint, enum Type, Scons, 配置文件, Gdextension, 配置文件, 实现源码, 2D, 基础移动, 怪物追踪玩家, 暴击公式, 3D, 基础移动, 单例, 存储系统, GUI, 按钮, 插件, 背包, 设计模式, 简介, 命令模式, 命令模式的基本结构, 游戏编程中的命令模式示例, 命令模式的优点, 注意事项, 享元模式, 状态模式, 子类沙箱模式, 工厂模式, 函数工厂, 装配系统源码模板输出字符串用注册方法注册属性方法注册属性注册信号注册枚举注册注册常量注册属性声明枚举常量枚举底下低下常量常量声明信号发送接受信号数组普通数组特定数组注册实例对象注意在实例化对象时应该使用来实例化不应该用因为没法释放可能导致内存泄漏调用单例单例需要包含头文件重写虚函数虚函数声明开始时调用物理帧循环检测输入需要头文件虚函数源码的用法检查器仅显示特定资源没有特定的提示表示属性是一个范围值例如一个滑动条表示属性是一个枚举类型可以从预定义的值中选择与类似但可能提供建议的值可能与动画的缓动相关特别是指数缓动表示属性可以链接到另一个属性或资源表示属性是一个标志位集合如与图层相关的提示用于或渲染物理或导航提示用户选择文件提示用户选择目录与类似但可能指向全局路径或资源提示用户选择特定类型的资源表示属性是一个多行文本字段可能与表达式求值或编写表达式相关在文本字段中显示占位符文本颜色选择器不显示通道表示属性是一个对象属性是一个表示类型的字符串表示属性是一个节点路径指向正在编辑的节点可能用于警告用户对象太大或复杂提示用户选择特定类型的节点路径提示用户保存文件可能是全局的整数属性实际上是对象或指针提示用户选择数组的元素类型表示属性是区域设置表示属性是一个可以本地化的字符串提示用户选择特定类型的节点在编辑器中隐藏四元数编辑可能是笔误应为属性是一个密码字段应该隐藏输入枚举中的最大值通常用于范围检查这些提示为编辑器和开发者提供了关于如何解释和编辑属性的上下文信息从而提高了工作效率和用户体验表示无或空值原子类型布尔值真假整数浮点数字符串数学类型二维向量前者为浮点数后者为整数二维矩形同样有浮点数和整数版本三维向量浮点数和整数版本二维变换矩阵四维向量浮点数和整数版本平面在数学中通常表示为点法式四元数用于表示旋转轴对齐包围盒常用于碰撞检测基础矩阵通常用于变换三维变换矩阵投影矩阵可能用于图形渲染其他类型颜色值字符串名称可能是优化后的字符串类型用于快速比较和哈希节点路径在场景图中定位节点资源标识符用于标识资源对象引用可调用的函数方法或信号信号用于在对象之间通信字典或映射存储键值对数组可以存储任何类型的元素类型化数组这些是固定类型的数组存储特定类型的元素如字节整数浮点数向量等它们可能用于优化性能或内存使用枚举中的最大值通常用于范围检查或其他需要枚举最大值的情况配置文件指定头文件位置匹配源文件位置声明一个之将右边的值加到左边的值排序名字文件名及生成路径生成动态库文件名构建的路径依赖构建文件配置文件实现源码基础移动怪物追踪玩家怪物移动向量玩家位置怪物全局位置速度怪物位置怪物移动向量暴击公式暴击随机率暴击面板暴击率暴击随机率暴击率暴击伤害加成暴击伤害为基础移动暂时没有单例存储系统头文件返回单例数据写入数据读取源文件按钮暂时没有插件背包暂时没有设计模式简介游戏编程模式电子书模式详情模式详情命令模式通过命令控制对象行为需要的话可以记录状态并实现撤回更新方法模式对每个对象单独调用更新函数享元模式多个对象共用同一个资源或者属性游戏循环模式游戏循环底层状态模式通过变量切换对象的不同状态双缓冲模式绘制相关当在执行是在准备在执行时在准备单例模式静态方法全局变量可以全局访问的属性和方法字节码模式自定义编程语言原型模式复制当前对象生成新的对象泛型模板类似场景文件预制体的实现事件队列将事件加入队列等待执行处理类似观察者模式多出缓存区域观察者模式主题对象向所有观察者对象发送信号在中可通过信号实现服务器定位器类似单例子类沙箱模式将子对象重复的方法写在基类避免高耦合度类型对象对象可通过外部配置文件修改产生新的对象如表格和等组件模式对对象添加组件进行使用挂脚本就是一种组件模式命令模式在游戏编程中命令模式是一种常见的设计模式它允许将请求封装为对象从而实现请求的排队记录撤销重做以及将请求的执行者与请求本身解耦这对于游戏开发中的多种场景如用户界面交互游戏逻辑执行行为模拟等都是非常有用的命令模式的基本结构命令接口定义一个命令的接口声明执行的方法具体命令实现命令接口并关联一个接收者对象调用接收者对象的相应操作以执行请求接收者知道如何执行与请求相关的操作任何类都可能作为一个接收者调用者要求命令执行一个请求它包含一个或多个命令对象并调用命令对象的执行方法客户端创建具体的命令对象并设置它的接收者游戏编程中的命令模式示例将需要执行的对象具体行为通过命令对象来调用当按下键玩家的名字改为小海按下键又变为小月接收者玩家玩家玩家小月命令接口命令接口抽象命令执行撤销具体命令实现命令对象命令抽象命令玩家玩家指针指向玩家实例记录玩家属性命令玩家玩家玩家指针玩家执行玩家指针记录玩家属性玩家指针指向玩家行为通过字符串更改属性玩家指针撤销玩家指针撤销玩家属性将属性更改为上一步记录的值玩家指针玩家玩家实例命令命令实例玩家实例初始化引用玩家对象命令实例执行小海命令实例撤销调用者调用者可以是游戏的主循环管理器或系统等在这个示例中我们可以假设有一个管理器它负责处理玩家的点击事件客户端客户端通常是游戏的初始化代码或配置部分在这里我们创建具体的命令对象并将其与接收者关联起来然后我们将命令对象传递给调用者如管理器命令模式的优点解耦命令模式将请求的执行者与请求本身解耦使得请求的发送者和接收者可以独立地变化可扩展性新的命令可以很容易地添加到系统中而无需修改现有的类可撤销重做通过实现等方法可以很容易地支持命令的撤销和重做功能队列和日志命令对象可以存储在队列中以实现命令的批量执行或延迟执行也可以存储在日志中以记录游戏的历史状态注意事项命令模式可能会增加系统的复杂性和开销因此应谨慎使用在简单场景中可能不需要使用命令模式在实现命令模式时要确保正确地管理命令对象的生命周期以避免内存泄漏等问题享元模式在游戏编程中享元模式是一种用于优化性能的设计模式它通过共享来避免大量拥有相同内容对象的开销在游戏开发中这种模式特别适用于那些需要创建大量相似对象的情况如玩家角色怪物道具等享元模式的核心思想是将对象的内部状态即不随环境改变而改变的属性和外部状态即随环境改变而改变的属性进行区分通过共享内部状态可以显著减少对象的数量从而降低内存消耗和提高性能在游戏编程中享元模式的应用场景可能包括角色创建在大型多人在线游戏中可能存在大量的玩家角色这些角色可能有很多相同的属性如种族职业等级等而装备技能位置等属性则各不相同通过享元模式可以将这些共享的属性存储在一个享元对象中并为每个角色分配一个包含其特有属性的实例怪物生成在游戏中可能需要生成大量的怪物这些怪物可能具有相同的外观属性和行为但位置状态等属性可能各不相同通过享元模式可以共享怪物的内部状态从而减少内存消耗道具管理在游戏中可能存在大量的道具这些道具可能具有相同的属性如名称类型功能等但数量位置等属性可能各不相同通过享元模式可以共享道具的内部状态从而优化内存使用在实现享元模式时通常需要定义两个主要类享元类用于存储对象的内部状态这个类通常具有一个静态的工厂方法或工厂类来管理享元对象的创建和共享上下文类用于存储对象的外部状态这个类持有享元对象的引用并提供操作这些对象的方法当需要操作对象时上下文类会将享元对象与其外部状态结合起来需要注意的是享元模式虽然可以显著优化性能但也可能增加系统的复杂性因此在使用享元模式时需要权衡其优点和缺点并根据具体需求进行选择和调整享元接口具体的享元类外部状态通常不应在享元类中直接存储但为简单起见这里这样做享元工厂类上下文类用于存储外部状态外部状态在上下文中存储通知享元更新其位置这里只是为了演示客户端代码创建并共享享元对象使用上下文来设置外部状态并执行操作状态模式在游戏编程中状态模式是一种行为设计模式它允许一个对象在其内部状态改变时改变它的行为状态模式使得对象看起来好像修改了它的类但它实际上是通过将对象的行为委托给其当前状态对象来改变其行为的这提供了一种使行为依赖于对象内部状态变化的解决方案而不是通过大量的条件语句和复杂的逻辑来管理这些变化以下是一个简单的游戏编程中状态模式的示例假设我们有一个角色如玩家角色可以处于不同的状态如空闲移动攻击等状态基类空闲状态切换到其他状态移动状态角色移动的逻辑切换到其他状态攻击状态角色攻击的逻辑切换到其他状态角色类其他角色相关的方法输出输出输出清理动态分配的状态对象在实际应用中可能需要更复杂的内存管理在这个例子中类有一个类型的成员变量它指向当前的状态对象类有一个方法来更改其当前状态以及一个方法来调用当前状态对象的方法每个状态类如都实现了方法该方法定义了当角色处于该状态时应该执行的行为通过使用状态模式我们可以轻松地添加新的状态和行为而无需修改类或现有的状态类这提高了代码的可维护性和可扩展性子类沙箱模式子类沙箱模式是一种设计模式主要用于在面向对象编程中管理子类与基类之间的行为和操作该模式的核心思想是将一些通用的操作或行为定义为基类的方法而子类则通过重载或实现这些方法来实现特定的行为通过这种方式可以将所有与这些操作相关的耦合都聚集到基类从而使子类与其他类更加独立子类沙箱模式通常适用于以下情况有一个带有大量子类的基类基类能够提供所有子类可能需要执行的操作集合在子类之间有重叠的代码你想让它们之间更容易地共享代码你想使这些继承类和程序的其他代码之间的耦合最小化在子类沙箱模式中基类通常包含一些抽象方法或虚方法这些方法定义了子类需要实现的行为子类通过重载这些方法来实现自己的特定行为同时基类还可以包含一些受保护的方法这些方法提供了一些子类在实现特定行为时需要调用的操作这些受保护的方法可以被视为沙箱中的安全原语子类可以在其中安全地执行特定的操作子类沙箱模式的优点包括减少代码冗余通过在基类中定义通用的操作可以避免在子类中重复编写相同的代码提高代码的可维护性由于所有的耦合都聚集到基类子类与其他类之间的依赖关系变得更加清晰和简单从而提高了代码的可维护性促进代码复用子类可以通过继承基类来重用基类中定义的操作从而提高了代码的复用性然而子类沙箱模式也存在一些缺点例如当基类包含大量的方法时它可能会变得庞大且难以维护此外如果子类需要访问基类中的受保护方法则可能会破坏封装性并增加类之间的耦合度因此在使用子类沙箱模式时需要权衡其优缺点并根据具体的应用场景来选择是否使用该模式在中子类沙箱模式的一个示例可以通过创建一个基类该类包含一些虚函数表示子类可能需要实现的行为以及一个或多个受保护的方法表示子类可以安全调用的操作子类将继承这个基类并根据需要重载虚函数来实现特定的行为以下是一个简单的示例展示了子类沙箱模式的概念基类包含虚函数和受保护的方法虚函数子类需要实现受保护的方法子类可以调用子类继承基类并重载虚函数重载基类中的虚函数调用基类中的受保护方法主函数用于测试创建子类对象调用子类对象的虚函数该函数会调用基类中的受保护方法在这个示例中类是一个基类它包含一个纯虚函数和一个受保护的方法类是的子类它重载了函数并在其中调用了基类的方法在函数中我们创建了一个类的对象并调用了它的方法该方法会输出一些信息并调用基类的受保护方法请注意这个示例主要是为了演示子类沙箱模式的概念而不是一个完整的应用程序在实际的应用程序中基类和子类可能会包含更多的属性和方法并且它们之间的关系可能会更加复杂工厂模式函数工厂在工厂类声明一个返回类的实例的函数这段代码创建了一个怪物基类然后通过继承实现了不同怪物然后创建工厂来返回不同怪物的实例怪物的基类怪物基类怪物基类怪物基类共同方法怪物实现都继承之怪物基类野猪怪物基类野猪怪物基类野猪黑熊怪物基类黑熊怪物基类黑熊蜘蛛怪物基类蜘蛛怪物基类蜘蛛声明一个怪物工厂用于生产怪物怪物工厂怪物基类创建野猪野猪怪物基类创建黑熊野猪怪物基类创建蜘蛛野猪怪物工厂工厂怪物基类野猪工厂创建野猪讨之助怪物基类黑熊工厂创建黑熊小明怪物基类蜘蛛工厂创建蜘蛛假面骑士野猪共同方法黑熊共同方法蜘蛛共同方法函数工厂模式抽象工厂通过抽象工厂和抽象产品生产一系列的产品比图我要进货手机有安卓和苹果等品牌我就需要这个手机工厂生产了这两种品牌的手机产品抽象类所以苹果产品都继承这个类苹果苹果输出产品名字苹果电脑实现苹果电脑苹果苹果电脑输出产品名字苹果电脑苹果手机实现苹果手机苹果苹果手机输出产品名字苹果手机安卓产品抽象类索引安卓产品都继承这个类安卓安卓输出产品名字安卓点啊弄实现安卓电脑安卓安卓电脑输出产品名字安卓电脑安卓手机实现安卓手机安卓安卓手机输出产品名字安卓手机工厂抽象类数码工厂数码工厂安卓生产安卓产品苹果生产苹果产品工厂实现可以生产各种品牌的电脑电脑工厂数码工厂电脑工厂安卓生产安卓产品安卓电脑苹果生产苹果产品苹果电脑工厂实现可以生产各种品牌的手机手机工厂数码工厂手机工厂安卓生产安卓产品安卓手机苹果生产苹果产品苹果手机我需要生产电脑电脑工厂电脑商电脑工厂苹果苹果电脑商生产苹果产品安卓安卓平板电脑商生产安卓产品苹果输出产品名字安卓平板输出产品名字我需要手机手机工厂手机商手机工厂苹果苹果手机商生产苹果产品苹果输出产品名字怪物工厂通过抽象怪物工厂创建一系列的类在游戏开发中抽象工厂模式的使用通常出现在以下场景需要创建多个相关或相互依赖的对象时抽象工厂模式允许你定义一个接口来创建一组相关的对象而无需指定它们的具体类这在游戏开发中很常见因为游戏通常包含许多相互关联的对象如角色武器装备等需要处理多个产品族时游戏可能会根据不同的版本难度或模式而有不同的产品族即一组相关的对象例如一个游戏可能有不同的角色族如战士法师盗贼等每个角色族都有自己的武器装备和技能使用抽象工厂模式你可以为每个角色族创建一个具体的工厂该工厂负责创建该角色族所需的所有对象需要隐藏对象的创建细节时在游戏开发中你可能希望隐藏对象的创建细节以便在不影响客户端代码的情况下更改对象的实现抽象工厂模式允许你定义一个接口来创建对象而客户端代码只需与该接口交互而无需知道对象的实际创建过程需要提高系统的可扩展性和可维护性时随着游戏的发展你可能需要添加新的角色武器或装备使用抽象工厂模式你可以轻松地添加新的产品族或产品而无需修改现有的客户端代码这有助于提高系统的可扩展性和可维护性总之抽象工厂模式在游戏开发中是一种非常有用的设计模式它可以帮助你创建和管理一组相关的对象并隐藏对象的创建细节如果你的游戏需要处理多个产品族或需要提高系统的可扩展性和可维护性那么抽象工厂模式可能是一个很好的选择在游戏开发中抽象工厂模式的一个典型应用例子是创建不同类型的角色如战士法师以及他们各自的装备以下是一个简化的例子来说明这一点首先定义一些接口来表示不同类型的角色和装备角色接口装备武器和装备其他角色方法战士接口和具体实现其他战士方法法师接口和具体实现其他法师方法武器接口武器的方法战士武器和法师武器的具体实现略装备接口装备的方法战士装备和法师装备的具体实现略接下来定义一个抽象工厂接口来创建角色和装备抽象工厂接口然后为每个产品族如战士和法师创建一个具体的工厂类战士工厂返回战士武器的实例返回战士装备的实例其他法师相关的方法在这里不需要实现法师工厂返回法师武器的实例返回法师装备的实例其他战士相关的方法在这里不需要实现最后在游戏的主逻辑或某个客户端代码中你可以使用这些工厂来创建角色和装备创建战士族输出其他战士相关的操作创建法师族先删除前一个工厂实例输出其他法师相关的操作这个例子展示了如何使用抽象工厂模式来创建和管理游戏中不同类型的角色和装备每个具体的工厂类负责创建它所属产品族的对象从而实现了创建过程的封装和隔离这有助于保持代码的清晰性和可维护性并允许在不影响客户端代码的情况下添加新的产品族或修改现有产品族的实现装配系统所需节点作为部件放置的位置方便调整位置装备模型枪身枪身枪管枪管瞄准仪瞄准仪资源每当资源变更时刷新配件节点枪身资源武器资源类枪身资源枪身资源枪身资源武器资源更新枪管资源武器资源类枪管资源枪管资源枪管资源武器资源更新瞄准仪资源武器资源类瞄准仪资源瞄准仪资源瞄准仪资源武器资源更新武器资源更新初始化节点将配件全部清除枪身枪身枪身枪管枪管枪管瞄准仪瞄准仪瞄准仪检查资源是否存在枪身枪身资源武器场景枪身资源武器场景路径枪身武器场景如果武器不存在初始化其他配件枪管资源瞄准仪资源检查其他配件如果存在则添加到节点树枪管枪管资源枪管场景枪管资源武器场景路径枪管枪管场景瞄准仪瞄准仪资源瞄准仪场景瞄准仪资源武器场景路径瞄准仪瞄准仪场景背包负责更新装备武器展示场景装备模型武器装备场景装备模型物品背包更新装备武器展示场景更新装备武器装备场景更新装备装备模型枪身资源物品背包枪管资源物品背包瞄准仪资源物品背包背包索引背包物品背包索引背包物品背包索引空纹理背包物品背包索引背包物品背包索引背包物品背包索引检查是否为武器基类数据处理背包物品背包索引背包物品背包背包物品背包索引背包物品背包背包物品背包背包物品背包索引背包物品背包索引背包物品背包游戏能力系统输出字符串用',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-02-07 23:33:22',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="/img/RR.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://space.bilibili.com/253251579" title="哔哩哔哩"><img class="back-menu-item-icon" src="https://th.bing.com/th?id=ODLS.1e67f861-d980-4c01-ba66-9450f90172f4&amp;w=32&amp;h=32&amp;qlt=96&amp;pcl=fffffc&amp;o=6&amp;cb=15&amp;pid=1.2" alt="哔哩哔哩"/><span class="back-menu-item-text">哔哩哔哩</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://blender.kim/" title="魔酷网"><img class="back-menu-item-icon" src="https://th.bing.com/th?id=ODLS.88012746-d99b-4589-a17c-d5eeaad474fd&amp;w=32&amp;h=32&amp;qlt=99&amp;pcl=fffffc&amp;o=6&amp;cb=15&amp;pid=1.2" alt="魔酷网"/><span class="back-menu-item-text">魔酷网</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://www.aplaybox.com/" title="模之屋"><img class="back-menu-item-icon" src="https://th.bing.com/th?id=ODLS.221b96bc-0e7f-4f7d-b980-a051789b763b&amp;w=32&amp;h=32&amp;qlt=90&amp;pcl=fffffa&amp;o=6&amp;cb=15&amp;pid=1.2" alt="模之屋"/><span class="back-menu-item-text">模之屋</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://huaban.com/follow" title="花瓣"><img class="back-menu-item-icon" src="https://th.bing.com/th?id=ODLS.9e0310ad-0fa0-486f-8c12-81bcf016e199&amp;w=32&amp;h=32&amp;qlt=98&amp;pcl=fffffc&amp;o=6&amp;cb=15&amp;pid=1.2" alt="花瓣"/><span class="back-menu-item-text">花瓣</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://www.zhihu.com/people/35-4-25-32" title="知乎"><img class="back-menu-item-icon" src="https://th.bing.com/th?id=ODLS.66059014-8637-4840-b8a6-78e2a6e07c34&amp;w=17&amp;h=17&amp;o=6&amp;cb=15&amp;pid=1.2" alt="知乎"/><span class="back-menu-item-text">知乎</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">凝雨个人博客</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size: 0.9em;"></i><span> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 追番页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/htim/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size: 0.9em;"></i><span> 小空调</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/equipment/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size: 0.9em;"></i><span> 我的装备</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> Search</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="/img/ds.png" target="_blank"><img class="post-qr-code-img" alt="微信" src="/img/ds.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/ds.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="/img/ds.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> Newest Comments</span></div><div class="aside-list"><span>loading...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/%E5%8F%98%E9%87%8F/" style="font-size: 1.05rem;">变量<sup>5</sup></a><a href="/tags/%E5%A4%87%E5%BF%98%E5%BD%95/" style="font-size: 1.05rem;">备忘录<sup>1</sup></a><a href="/tags/%E5%AD%A6%E4%B9%A0/" style="font-size: 1.05rem;">学习<sup>35</sup></a><a href="/tags/%E8%84%9A%E6%9C%AC/" style="font-size: 1.05rem;">脚本<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>Archives</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/03/"><span class="card-archive-list-date">March 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">31</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/03/"><span class="card-archive-list-date">March 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">6</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/godot/" itemprop="url">godot</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/%E5%AD%A6%E4%B9%A0/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>学习</span></a></span></div></div><h1 class="post-title" itemprop="name headline">Gdextension</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2025-03-15T02:03:29.983Z" title="Created 2025-03-15 10:03:29">2025-03-15</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-02-07T15:33:22.022Z" title="Updated 2025-02-07 23:33:22">2025-02-07</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">Word count:</span><span class="word-count" title="文章字数">9.7k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">Reading time:</span><span>37min</span></span><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="Gdextension"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">Post View:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为贵州"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>贵州</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="/img/ww/D003.png"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://example.com/2025/03/15/%E6%88%88%E5%A4%9A/GDScript/Gdextension/"><header><a class="post-meta-categories" href="/categories/godot/" itemprop="url">godot</a><a href="/tags/%E5%AD%A6%E4%B9%A0/" tabindex="-1" itemprop="url">学习</a><h1 id="CrawlerTitle" itemprop="name headline">Gdextension</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">凝雨</span><time itemprop="dateCreated datePublished" datetime="2025-03-15T02:03:29.983Z" title="Created 2025-03-15 10:03:29">2025-03-15</time><time itemprop="dateCreated datePublished" datetime="2025-02-07T15:33:22.022Z" title="Updated 2025-02-07 23:33:22">2025-02-07</time></header><h1 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h1><h2 id="模板"><a href="#模板" class="headerlink" title="模板"></a>模板</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> THREEN_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> THREEN_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;godot_cpp/classes/node.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//#include &lt;godot_cpp/core/class_db.hpp&gt;</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;godot_cpp/variant/utility_functions.hpp&gt;</span>  <span class="comment">//输出字符串用</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> godot;</span><br><span class="line"></span><br><span class="line"><span class="comment">//#define VARIANT_ARG_MAX 8</span></span><br><span class="line"><span class="comment">//#define VARIANT_ARG_DECLARE const Variant &amp;p_arg1, const Variant &amp;p_arg2, const Variant &amp;p_arg3, const Variant &amp;p_arg4, const //Variant &amp;p_arg5, const Variant &amp;p_arg6, const Variant &amp;p_arg7, const Variant &amp;p_arg8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Myclass</span> : <span class="keyword">public</span> Node</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">GDCLASS</span>(Myclass, Node);</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="type">static</span> <span class="type">void</span> _bind_methods();</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">GAME</span>();</span><br><span class="line">    ~<span class="built_in">GAME</span>();</span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// THREEN_H</span></span></span><br></pre></td></tr></table></figure>

<h2 id="bind-methods"><a href="#bind-methods" class="headerlink" title="_bind_methods()"></a>_bind_methods()</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> Player::_bind_methods()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//注册方法</span></span><br><span class="line">    ClassDB::<span class="built_in">bind_method</span>(<span class="built_in">D_METHOD</span>(<span class="string">&quot;cout_property&quot;</span>), &amp;Player::cout_property);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//注册属性方法</span></span><br><span class="line">    ClassDB::<span class="built_in">bind_method</span>(<span class="built_in">D_METHOD</span>(<span class="string">&quot;set_array&quot;</span>, <span class="string">&quot;GBarray&quot;</span>), &amp;Player::set_array);</span><br><span class="line">    ClassDB::<span class="built_in">bind_method</span>(<span class="built_in">D_METHOD</span>(<span class="string">&quot;get_array&quot;</span>), &amp;Player::get_array);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//注册属性</span></span><br><span class="line">    <span class="built_in">ADD_PROPERTY</span>(<span class="built_in">PropertyInfo</span>(Variant::FLOAT, <span class="string">&quot;speed&quot;</span>, PROPERTY_HINT_RANGE<span class="string">&quot;    -99999,99999,0.001,or_less,or_greater,hide_slider,suffix:px&quot;</span>), <span class="string">&quot;set_speed&quot;</span>, <span class="string">&quot;get_speed&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//注册信号</span></span><br><span class="line">    <span class="built_in">ADD_SIGNAL</span>(<span class="built_in">MethodInfo</span>(<span class="string">&quot;palyer_sig&quot;</span>,<span class="built_in">PropertyInfo</span>(Variant::OBJECT, <span class="string">&quot;key1&quot;</span>),  <span class="built_in">PropertyInfo</span>(Variant::OBJECT, <span class="string">&quot;key2&quot;</span>)));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//注册枚举</span></span><br><span class="line">    <span class="built_in">BIND_ENUM_CONSTANT</span>(MON);</span><br><span class="line">    <span class="comment">//注册flag</span></span><br><span class="line">    <span class="built_in">BIND_BITFIELD_FLAG</span>(Run);</span><br><span class="line">    <span class="comment">//注册常量</span></span><br><span class="line">    <span class="built_in">BIND_CONSTANT</span>(MAX_HEALTH);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="注册属性"><a href="#注册属性" class="headerlink" title="注册属性"></a>注册属性</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">bool</span> br = <span class="literal">true</span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">set_br</span><span class="params">(<span class="type">bool</span> key)</span></span>;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">get_br</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">AbilitySystem::get_br</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> br;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">AbilitySystem::set_br</span><span class="params">(<span class="type">bool</span> key)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	br = key;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> AbilitySystem::_bind_methods()</span><br><span class="line">&#123;</span><br><span class="line">	ClassDB::<span class="built_in">bind_method</span>(<span class="built_in">D_METHOD</span>(<span class="string">&quot;set_br&quot;</span>,<span class="string">&quot;br&quot;</span>), &amp;AbilitySystem::set_br);</span><br><span class="line">	ClassDB::<span class="built_in">bind_method</span>(<span class="built_in">D_METHOD</span>(<span class="string">&quot;get_br&quot;</span>), &amp;AbilitySystem::get_br);</span><br><span class="line"></span><br><span class="line">	ClassDB::<span class="built_in">add_property</span>(<span class="string">&quot;AbilitySystem&quot;</span>,</span><br><span class="line">		<span class="built_in">PropertyInfo</span>(Variant::BOOL, <span class="string">&quot;br&quot;</span>),</span><br><span class="line">		<span class="string">&quot;set_br&quot;</span>,</span><br><span class="line">		<span class="string">&quot;get_br&quot;</span></span><br><span class="line">	);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="声明-枚举-Flag-常量"><a href="#声明-枚举-Flag-常量" class="headerlink" title="声明:枚举,Flag,常量"></a>声明:枚举,Flag,常量</h2><ul>
<li>枚举</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">testEnum</span> &#123;</span><br><span class="line">MON,</span><br><span class="line">TUE,</span><br><span class="line">WED = <span class="number">7</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//底下</span></span><br><span class="line">    <span class="built_in">VARIANT_ENUM_CAST</span>(Test::testEnum);</span><br></pre></td></tr></table></figure>

<ul>
<li>flag</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">testFlag</span> </span><br><span class="line">&#123;</span><br><span class="line">Run,</span><br><span class="line">Idle</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//低下</span></span><br><span class="line"><span class="built_in">VARIANT_BITFIELD_CAST</span>(Test::testFlag);</span><br></pre></td></tr></table></figure>

<ul>
<li>常量</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//常量声明</span></span><br><span class="line"><span class="keyword">enum</span> &#123;</span><br><span class="line">MAX_HEALTH = <span class="number">100</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="信号"><a href="#信号" class="headerlink" title="信号"></a>信号</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//发送</span></span><br><span class="line"><span class="built_in">emit_signal</span>(<span class="string">&quot;position_changed&quot;</span>, <span class="keyword">this</span>, new_position);</span><br><span class="line"><span class="comment">//接受信号</span></span><br><span class="line"><span class="built_in">connect</span>(<span class="string">&quot;visibility_changed&quot;</span>, <span class="built_in">Callable</span>(<span class="keyword">this</span>, <span class="string">&quot;cout_sig&quot;</span>));</span><br></pre></td></tr></table></figure>

<h2 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h2><ul>
<li>普通数组</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Array _array;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">set_array</span><span class="params">(Array p_array)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    _array=p_array;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">Array <span class="title">get_array</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> _array;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>特定数组</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">PackedVector2Array polygon;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">set_polygon</span><span class="params">(<span class="type">const</span> PackedVector2Array&amp; p_polygon)</span> </span>&#123;</span><br><span class="line">    polygon = p_polygon;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">PackedVector2Array <span class="title">get_polygon</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> polygon;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//注册</span></span><br><span class="line">    ClassDB::<span class="built_in">bind_method</span>(<span class="built_in">D_METHOD</span>(<span class="string">&quot;set_polygon&quot;</span>, <span class="string">&quot;polygon&quot;</span>), &amp;Player::set_polygon);</span><br><span class="line">    ClassDB::<span class="built_in">bind_method</span>(<span class="built_in">D_METHOD</span>(<span class="string">&quot;get_polygon&quot;</span>), &amp;Player::get_polygon);</span><br><span class="line">    <span class="built_in">ADD_PROPERTY</span>(<span class="built_in">PropertyInfo</span>(Variant::PACKED_VECTOR2_ARRAY, <span class="string">&quot;polygon&quot;</span>), <span class="string">&quot;set_polygon&quot;</span>, <span class="string">&quot;get_polygon&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>GDVIRTUAL_BIND(_process, “delta”);</p>
<h2 id="实例对象"><a href="#实例对象" class="headerlink" title="实例对象"></a>实例对象</h2><ul>
<li>注意:在实例化GODOT对象时应该使用memnew来实例化,不应该用new,因为GODOT没法释放new可能导致内存泄漏</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Node node=<span class="built_in">memnew</span>(Node);</span><br></pre></td></tr></table></figure>

<h2 id="调用单例"><a href="#调用单例" class="headerlink" title="调用单例"></a>调用单例</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Input单例     需要包含头文件</span></span><br><span class="line">Input::<span class="built_in">get_singleton</span>()-&gt;<span class="built_in">get_vector</span>(<span class="string">&quot;ui_left&quot;</span>, <span class="string">&quot;ui_right&quot;</span>, <span class="string">&quot;ui_up&quot;</span>, <span class="string">&quot;ui_down&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="重写虚函数"><a href="#重写虚函数" class="headerlink" title="重写虚函数"></a>重写虚函数</h2><ul>
<li>虚函数声明</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//开始时调用</span></span><br><span class="line"><span class="type">void</span> _ready();</span><br><span class="line"><span class="type">void</span> Player::_ready()</span><br><span class="line">&#123;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//物理帧循环</span></span><br><span class="line"><span class="type">void</span> _physics_process(<span class="type">float</span> delta);</span><br><span class="line"><span class="type">void</span> Player::_physics_process(<span class="type">float</span> delta)</span><br><span class="line">&#123;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//检测输入</span></span><br><span class="line"><span class="type">void</span> _input(<span class="type">const</span> Ref&lt;InputEvent&gt;&amp; event);  <span class="comment">//需要头文件 #include &lt;godot_cpp/classes/input_event.hpp&gt;</span></span><br><span class="line"><span class="type">void</span> Player::_input(<span class="type">const</span> Ref&lt;InputEvent&gt;&amp; event)</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>node虚函数源码</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">virtual</span> <span class="type">void</span> _process(<span class="type">double</span> delta);</span><br><span class="line"><span class="keyword">virtual</span> <span class="type">void</span> _physics_process(<span class="type">double</span> delta);</span><br><span class="line"><span class="keyword">virtual</span> <span class="type">void</span> _enter_tree();</span><br><span class="line"><span class="keyword">virtual</span> <span class="type">void</span> _exit_tree();</span><br><span class="line"><span class="keyword">virtual</span> <span class="type">void</span> _ready();</span><br><span class="line"><span class="keyword">virtual</span> PackedStringArray _get_configuration_warnings() <span class="type">const</span>;</span><br><span class="line"><span class="keyword">virtual</span> <span class="type">void</span> _input(<span class="type">const</span> Ref&lt;InputEvent&gt; &amp;event);</span><br><span class="line"><span class="keyword">virtual</span> <span class="type">void</span> _shortcut_input(<span class="type">const</span> Ref&lt;InputEvent&gt; &amp;event);</span><br><span class="line"><span class="keyword">virtual</span> <span class="type">void</span> _unhandled_input(<span class="type">const</span> Ref&lt;InputEvent&gt; &amp;event);</span><br><span class="line"><span class="keyword">virtual</span> <span class="type">void</span> _unhandled_key_input(<span class="type">const</span> Ref&lt;InputEvent&gt; &amp;event);</span><br></pre></td></tr></table></figure>

<h2 id="ADD-PROPERTY的用法"><a href="#ADD-PROPERTY的用法" class="headerlink" title="ADD_PROPERTY的用法"></a>ADD_PROPERTY的用法</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//检查器仅显示特定资源</span></span><br><span class="line"><span class="built_in">ADD_PROPERTY</span>(<span class="built_in">PropertyInfo</span>(Variant::OBJECT, <span class="string">&quot;_resource&quot;</span>,PROPERTY_HINT_RESOURCE_TYPE, <span class="string">&quot;ReleStats&quot;</span>), <span class="string">&quot;set_resource&quot;</span>, <span class="string">&quot;get_resource&quot;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="enum-PropertyHint"><a href="#enum-PropertyHint" class="headerlink" title="enum PropertyHint"></a>enum PropertyHint</h4><ol>
<li><strong>PROPERTY_HINT_NONE</strong>：没有特定的提示。</li>
<li><strong>PROPERTY_HINT_RANGE</strong>：表示属性是一个范围值（例如，一个滑动条）。</li>
<li><strong>PROPERTY_HINT_ENUM</strong>：表示属性是一个枚举类型，可以从预定义的值中选择。</li>
<li><strong>PROPERTY_HINT_ENUM_SUGGESTION</strong>：与 <code>PROPERTY_HINT_ENUM</code> 类似，但可能提供建议的值。</li>
<li><strong>PROPERTY_HINT_EXP_EASING</strong>：可能与动画的缓动（easing）相关，特别是指数缓动。</li>
<li><strong>PROPERTY_HINT_LINK</strong>：表示属性可以链接到另一个属性或资源。</li>
<li><strong>PROPERTY_HINT_FLAGS</strong>：表示属性是一个标志位集合。</li>
<li><strong>PROPERTY_HINT_LAYERS_</strong>（如 <code>PROPERTY_HINT_LAYERS_2D_RENDER</code>）：与图层相关的提示，用于 2D 或 3D 渲染、物理或导航。</li>
<li><strong>PROPERTY_HINT_FILE</strong>：提示用户选择文件。</li>
<li><strong>PROPERTY_HINT_DIR</strong>：提示用户选择目录。</li>
<li><strong>PROPERTY_HINT_GLOBAL_FILE&#x2F;DIR</strong>：与 <code>PROPERTY_HINT_FILE/DIR</code> 类似，但可能指向全局路径或资源。</li>
<li><strong>PROPERTY_HINT_RESOURCE_TYPE</strong>：提示用户选择特定类型的资源。</li>
<li><strong>PROPERTY_HINT_MULTILINE_TEXT</strong>：表示属性是一个多行文本字段。</li>
<li><strong>PROPERTY_HINT_EXPRESSION</strong>：可能与表达式求值或编写表达式相关。</li>
<li><strong>PROPERTY_HINT_PLACEHOLDER_TEXT</strong>：在文本字段中显示占位符文本。</li>
<li><strong>PROPERTY_HINT_COLOR_NO_ALPHA</strong>：颜色选择器不显示 alpha 通道。</li>
<li><strong>PROPERTY_HINT_OBJECT_ID</strong>：表示属性是一个对象 ID。</li>
<li><strong>PROPERTY_HINT_TYPE_STRING</strong>：属性是一个表示类型的字符串。</li>
<li><strong>PROPERTY_HINT_NODE_PATH_TO_EDITED_NODE</strong>：表示属性是一个节点路径，指向正在编辑的节点。</li>
<li><strong>PROPERTY_HINT_OBJECT_TOO_BIG</strong>：可能用于警告用户对象太大或复杂。</li>
<li><strong>PROPERTY_HINT_NODE_PATH_VALID_TYPES</strong>：提示用户选择特定类型的节点路径。</li>
<li><strong>PROPERTY_HINT_SAVE_FILE&#x2F;GLOBAL_SAVE_FILE</strong>：提示用户保存文件，可能是全局的。</li>
<li><strong>PROPERTY_HINT_INT_IS_OBJECTID&#x2F;POINTER</strong>：整数属性实际上是对象 ID 或指针。</li>
<li><strong>PROPERTY_HINT_ARRAY_TYPE</strong>：提示用户选择数组的元素类型。</li>
<li><strong>PROPERTY_HINT_LOCALE_ID</strong>：表示属性是区域设置（locale）ID。</li>
<li><strong>PROPERTY_HINT_LOCALIZABLE_STRING</strong>：表示属性是一个可以本地化的字符串。</li>
<li><strong>PROPERTY_HINT_NODE_TYPE</strong>：提示用户选择特定类型的节点。</li>
<li><strong>PROPERTY_HINT_HIDE_QUATERNION_EDIT</strong>：在编辑器中隐藏四元数编辑（可能是笔误，应为“quaternion”）。</li>
<li><strong>PROPERTY_HINT_PASSWORD</strong>：属性是一个密码字段，应该隐藏输入。</li>
<li><strong>PROPERTY_HINT_MAX</strong>：枚举中的最大值，通常用于范围检查。</li>
</ol>
<p>这些提示为编辑器和开发者提供了关于如何解释和编辑属性的上下文信息，从而提高了工作效率和用户体验。</p>
<h4 id="enum-Type"><a href="#enum-Type" class="headerlink" title="enum Type"></a>enum Type</h4><ol>
<li><strong>NIL</strong>：表示无或空值。</li>
<li><strong>原子类型 (atomic types)</strong>：<ul>
<li><strong>BOOL</strong>：布尔值（真&#x2F;假）。</li>
<li><strong>INT</strong>：整数。</li>
<li><strong>FLOAT</strong>：浮点数。</li>
<li><strong>STRING</strong>：字符串。</li>
</ul>
</li>
<li><strong>数学类型 (math types)</strong>：<ul>
<li><strong>VECTOR2, VECTOR2I</strong>：二维向量，前者为浮点数，后者为整数。</li>
<li><strong>RECT2, RECT2I</strong>：二维矩形，同样有浮点数和整数版本。</li>
<li><strong>VECTOR3, VECTOR3I</strong>：三维向量，浮点数和整数版本。</li>
<li><strong>TRANSFORM2D</strong>：二维变换矩阵。</li>
<li><strong>VECTOR4, VECTOR4I</strong>：四维向量，浮点数和整数版本。</li>
<li><strong>PLANE</strong>：平面（在数学中通常表示为点法式）。</li>
<li><strong>QUATERNION</strong>：四元数，用于表示3D旋转。</li>
<li><strong>AABB</strong>：Axis-Aligned Bounding Box，轴对齐包围盒，常用于碰撞检测。</li>
<li><strong>BASIS</strong>：基础矩阵，通常用于3D变换。</li>
<li><strong>TRANSFORM3D</strong>：三维变换矩阵。</li>
<li><strong>PROJECTION</strong>：投影矩阵，可能用于图形渲染。</li>
</ul>
</li>
<li><strong>其他类型 (misc types)</strong>：<ul>
<li><strong>COLOR</strong>：颜色值。</li>
<li><strong>STRING_NAME</strong>：字符串名称，可能是优化后的字符串类型，用于快速比较和哈希。</li>
<li><strong>NODE_PATH</strong>：节点路径，在场景图中定位节点。</li>
<li><strong>RID</strong>：Resource ID，资源标识符，用于标识资源。</li>
<li><strong>OBJECT</strong>：对象引用。</li>
<li><strong>CALLABLE</strong>：可调用的函数、方法或信号。</li>
<li><strong>SIGNAL</strong>：信号，用于在对象之间通信。</li>
<li><strong>DICTIONARY</strong>：字典或映射，存储键值对。</li>
<li><strong>ARRAY</strong>：数组，可以存储任何类型的元素。</li>
</ul>
</li>
<li><strong>类型化数组 (typed arrays)</strong>：<ul>
<li>这些是固定类型的数组，存储特定类型的元素，如字节、整数、浮点数、向量等。它们可能用于优化性能或内存使用。</li>
</ul>
</li>
<li><strong>VARIANT_MAX</strong>：枚举中的最大值，通常用于范围检查或其他需要枚举最大值的情况。</li>
</ol>
<h1 id="Scons"><a href="#Scons" class="headerlink" title="Scons"></a>Scons</h1><h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line">libname = <span class="string">&quot;libmyts&quot;</span></span><br><span class="line"></span><br><span class="line">env = SConscript(<span class="string">&quot;godot-cpp/SConstruct&quot;</span>)</span><br><span class="line"></span><br><span class="line">env.Append(CPPPATH=[<span class="string">&quot;src/&quot;</span>,<span class="string">&quot;src/store/&quot;</span>,<span class="string">&quot;src/player/&quot;</span>])  <span class="comment">#指定头文件位置</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sources = Glob(<span class="string">&quot;#src/*.cpp&quot;</span>)  <span class="comment"># 匹配源文件位置</span></span><br><span class="line">sources+=Glob(<span class="string">&quot;#src/store/*.cpp&quot;</span>)</span><br><span class="line">sources+=Glob(<span class="string">&quot;#src/player/*.cpp&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> editor_builders</span><br><span class="line"></span><br><span class="line">docs_xml = []  <span class="comment">#声明一个之</span></span><br><span class="line">docs_xml += Glob(<span class="string">&quot;#src/doc_classes/*.xml&quot;</span>)  <span class="comment">#将右边的值加到左边的值</span></span><br><span class="line">docs_xml = <span class="built_in">sorted</span>(docs_xml)  <span class="comment">#排序</span></span><br><span class="line">docs_header = <span class="string">&quot;#src/doc_data_&#123;&#125;.gen.h&quot;</span>.<span class="built_in">format</span>(libname)  <span class="comment">#名字</span></span><br><span class="line">env.Command(docs_header, docs_xml, env.Action(editor_builders.make_doc_header, <span class="string">&quot;Generating documentation header.&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> env[<span class="string">&#x27;platform&#x27;</span>] == <span class="string">&#x27;linux&#x27;</span>: </span><br><span class="line">    <span class="keyword">pass</span> </span><br><span class="line"><span class="keyword">elif</span> env[<span class="string">&#x27;platform&#x27;</span>] == <span class="string">&#x27;windows&#x27;</span>:</span><br><span class="line">    libpath = <span class="string">&quot;F:/AGodot/GDE/godotGED4.3/bin/libtest&#123;&#125;&#123;&#125;&quot;</span>.<span class="built_in">format</span>(env[<span class="string">&quot;suffix&quot;</span>], env[<span class="string">&quot;SHLIBSUFFIX&quot;</span>]) <span class="comment">#文件名及生成路径</span></span><br><span class="line">    sharedlib = env.SharedLibrary(libpath,sources)      <span class="comment">#生成动态库(文件名,构建的cpp路径)</span></span><br><span class="line"><span class="comment">#env.Depends(sharedlib,docs_header)       #依赖                                    </span></span><br><span class="line">Default(sharedlib)        <span class="comment">#构建文件</span></span><br></pre></td></tr></table></figure>

<h1 id="Gdextension"><a href="#Gdextension" class="headerlink" title="Gdextension"></a>Gdextension</h1><h2 id="配置文件-1"><a href="#配置文件-1" class="headerlink" title="配置文件"></a>配置文件</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[configuration]</span><br><span class="line"></span><br><span class="line">entry_symbol = <span class="string">&quot;myts_library_init&quot;</span></span><br><span class="line">compatibility_minimum = <span class="number">4.1</span></span><br><span class="line"></span><br><span class="line">[libraries]</span><br><span class="line"></span><br><span class="line">[icons]</span><br><span class="line">GDExample = <span class="string">&quot;res://icons/gd_example.svg&quot;</span></span><br><span class="line"></span><br><span class="line">windows.x86_64.debug = <span class="string">&quot;res://bin/libtest.windows.template_debug.x86_64.dll&quot;</span></span><br></pre></td></tr></table></figure>

<h1 id="实现源码"><a href="#实现源码" class="headerlink" title="实现源码"></a>实现源码</h1><h2 id="2D"><a href="#2D" class="headerlink" title="2D"></a>2D</h2><h3 id="基础移动"><a href="#基础移动" class="headerlink" title="基础移动"></a>基础移动</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Player::move_role</span><span class="params">(<span class="type">float</span> delta)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    Vector2 direction = Input::<span class="built_in">get_singleton</span>()-&gt;<span class="built_in">get_vector</span>(<span class="string">&quot;ui_left&quot;</span>, <span class="string">&quot;ui_right&quot;</span>, <span class="string">&quot;ui_up&quot;</span>, <span class="string">&quot;ui_down&quot;</span>);</span><br><span class="line">    Vector2 velovty = <span class="built_in">get_velocity</span>();</span><br><span class="line">    <span class="keyword">if</span> (direction != <span class="built_in">Vector2</span>(<span class="number">0</span>,<span class="number">0</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        velovty = direction * speed;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        velovty=velovty.<span class="built_in">move_toward</span>(<span class="built_in">Vector2</span>(<span class="number">0</span>, <span class="number">0</span>), speed);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">set_velocity</span>(velovty);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="怪物追踪玩家"><a href="#怪物追踪玩家" class="headerlink" title="怪物追踪玩家"></a>怪物追踪玩家</h3><ul>
<li>怪物移动向量&#x3D;(玩家位置-怪物全局位置)*速度</li>
<li>怪物位置&#x3D;怪物移动向量</li>
</ul>
<h3 id="暴击公式"><a href="#暴击公式" class="headerlink" title="暴击公式"></a>暴击公式</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">暴击随机率=<span class="number">100</span>-暴击面板</span><br><span class="line">var 暴击率=randi_range(暴击随机率,<span class="number">0</span>)</span><br><span class="line"><span class="keyword">if</span> 暴击率==<span class="number">0</span>:</span><br><span class="line">    //暴击伤害加成</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    暴击伤害为<span class="number">1</span></span><br></pre></td></tr></table></figure>

<h2 id="3D"><a href="#3D" class="headerlink" title="3D"></a>3D</h2><h3 id="基础移动-1"><a href="#基础移动-1" class="headerlink" title="基础移动"></a>基础移动</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//暂时没有</span></span><br></pre></td></tr></table></figure>

<h2 id="单例"><a href="#单例" class="headerlink" title="单例"></a>单例</h2><h3 id="存储系统"><a href="#存储系统" class="headerlink" title="存储系统"></a>存储系统</h3><ul>
<li>头文件</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//返回单例</span></span><br><span class="line"><span class="function"><span class="type">static</span> Store* <span class="title">Store_static</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">//数据写入</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">store_write</span><span class="params">(Variant content,String path)</span></span>;</span><br><span class="line"><span class="comment">//数据读取</span></span><br><span class="line"><span class="function">Variant <span class="title">store_read</span><span class="params">(String path)</span></span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>源文件</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Store* <span class="title">Store::Store_static</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">static</span> Store store;</span><br><span class="line">    <span class="keyword">return</span> &amp;store;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Store::store_write</span><span class="params">(Variant content, String path)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Ref&lt;FileAccess&gt; write = FileAccess::<span class="built_in">open</span>(path,FileAccess::WRITE);</span><br><span class="line">    write-&gt;<span class="built_in">store_string</span>(content);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">Variant <span class="title">Store::store_read</span><span class="params">(String path)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Ref&lt;FileAccess&gt; read = FileAccess::<span class="built_in">open</span>(path, FileAccess::READ);</span><br><span class="line">    Variant variant=read-&gt;<span class="built_in">get_as_text</span>();</span><br><span class="line">    Variant js = JSON::<span class="built_in">parse_string</span>(variant);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> js;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="GUI"><a href="#GUI" class="headerlink" title="GUI"></a>GUI</h2><h3 id="按钮"><a href="#按钮" class="headerlink" title="按钮"></a>按钮</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//暂时没有</span></span><br></pre></td></tr></table></figure>

<h2 id="插件"><a href="#插件" class="headerlink" title="插件"></a>插件</h2><h3 id="背包"><a href="#背包" class="headerlink" title="背包"></a>背包</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//暂时没有</span></span><br></pre></td></tr></table></figure>

<h1 id="设计模式"><a href="#设计模式" class="headerlink" title="设计模式"></a>设计模式</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><ul>
<li><a target="_blank" rel="noopener" href="https://gpp.tkchu.me/">游戏编程模式电子书</a></li>
</ul>
<table>
<thead>
<tr>
<th>模式</th>
<th>详情</th>
<th>模式</th>
<th>详情</th>
</tr>
</thead>
<tbody><tr>
<td>命令模式</td>
<td>通过命令控制对象行为,需要的话可以记录状态并实现撤回</td>
<td>更新方法模式</td>
<td>对每个对象单独调用更新函数</td>
</tr>
<tr>
<td>享元模式</td>
<td>多个对象共用同一个资源或者属性</td>
<td>游戏循环模式</td>
<td>游戏循环底层</td>
</tr>
<tr>
<td>状态模式</td>
<td>通过变量切换对象的不同状态</td>
<td>双缓冲模式</td>
<td>绘制相关，当A在执行是B在准备，B在执行时A在准备</td>
</tr>
<tr>
<td>单例模式</td>
<td>静态方法,全局变量,可以全局访问的属性和方法</td>
<td>字节码模式</td>
<td>自定义编程语言?</td>
</tr>
<tr>
<td>原型模式</td>
<td>复制当前对象生成新的对象,(泛型,模板)。<br />类似场景文件，预制体的实现</td>
<td>事件队列</td>
<td>将事件加入队列,等待执行处理,类似观察者模式,多出缓存区域</td>
</tr>
<tr>
<td>观察者模式</td>
<td>主题对象向所有观察者对象发送信号，在godot中可通过信号实现</td>
<td>服务器定位器</td>
<td>类似单例</td>
</tr>
<tr>
<td>子类沙箱模式</td>
<td>将子对象重复的方法写在基类,避免高耦合度</td>
<td></td>
<td></td>
</tr>
<tr>
<td>类型对象</td>
<td>对象可通过外部配置文件修改产生新的对象，如表格和json等</td>
<td></td>
<td></td>
</tr>
<tr>
<td>组件模式</td>
<td>对对象添加组件进行使用，挂脚本就是一种组件模式</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h2 id="命令模式"><a href="#命令模式" class="headerlink" title="命令模式"></a>命令模式</h2><p>在游戏编程中，命令模式（Command Pattern）是一种常见的设计模式，它允许将请求封装为对象，从而实现请求的排队、记录、撤销&#x2F;重做以及将请求的执行者与请求本身解耦。这对于游戏开发中的多种场景，如用户界面交互、游戏逻辑执行、AI行为模拟等，都是非常有用的。</p>
<h3 id="命令模式的基本结构"><a href="#命令模式的基本结构" class="headerlink" title="命令模式的基本结构"></a>命令模式的基本结构</h3><ol>
<li><strong>命令接口（Command）</strong>：定义一个命令的接口，声明执行的方法。</li>
<li><strong>具体命令（ConcreteCommand）</strong>：实现命令接口，并关联一个接收者对象。调用接收者对象的相应操作以执行请求。</li>
<li><strong>接收者（Receiver）</strong>：知道如何执行与请求相关的操作。任何类都可能作为一个接收者。</li>
<li><strong>调用者（Invoker）</strong>：要求命令执行一个请求。它包含一个或多个命令对象，并调用命令对象的执行方法。</li>
<li><strong>客户端（Client）</strong>：创建具体的命令对象，并设置它的接收者。</li>
</ol>
<h3 id="游戏编程中的命令模式示例"><a href="#游戏编程中的命令模式示例" class="headerlink" title="游戏编程中的命令模式示例"></a>游戏编程中的命令模式示例</h3><ul>
<li><p>将需要执行的对象具体行为通过命令对象来调用</p>
</li>
<li><p>当按下1键玩家的名字改为小海,按下2键又变为小月</p>
</li>
</ul>
<ol>
<li><strong>接收者（Receiver）</strong>：</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> 玩家</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    玩家() &#123;&#125;;</span><br><span class="line">    ~玩家() &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    string name&#123;<span class="string">&quot;小月&quot;</span>&#125;;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>命令接口（Command）</strong>：</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//命令接口</span></span><br><span class="line"><span class="keyword">class</span> 抽象命令</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> <span class="type">void</span> 执行(string string)=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">virtual</span> <span class="type">void</span> 撤销()=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>2.<br>3. <strong>具体命令（ConcreteCommand）</strong>：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//实现命令对象</span></span><br><span class="line"><span class="keyword">class</span> 命令 :<span class="keyword">public</span> 抽象命令</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    玩家* 玩家指针;    <span class="comment">//指向玩家实例</span></span><br><span class="line">    string name;     <span class="comment">//记录玩家属性</span></span><br><span class="line"></span><br><span class="line">    命令(玩家&amp;p_玩家):玩家指针(&amp;p_玩家) &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="type">void</span> 执行(string p_name)</span><br><span class="line">    &#123;</span><br><span class="line">        name = 玩家指针-&gt;name;    <span class="comment">//记录玩家属性</span></span><br><span class="line">        玩家指针-&gt;name = p_name;   <span class="comment">//指向玩家行为,通过字符串更改name属性</span></span><br><span class="line">        cout &lt;&lt; 玩家指针-&gt;name &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">void</span> 撤销()</span><br><span class="line">    &#123;</span><br><span class="line">        玩家指针-&gt;name = name;     <span class="comment">//撤销玩家属性,将name属性更改为上一步记录的值</span></span><br><span class="line">        cout &lt;&lt; 玩家指针-&gt;name &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    玩家 玩家实例;</span><br><span class="line">    命令 命令实例(玩家实例);  <span class="comment">//初始化,引用玩家对象</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> op;</span><br><span class="line">        cin &gt;&gt; op;</span><br><span class="line">        <span class="keyword">if</span> (op == <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            命令实例.执行(<span class="string">&quot;小海&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (op == <span class="number">2</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            命令实例.撤销();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li><strong>调用者（Invoker）</strong>：</li>
</ol>
<p>调用者可以是游戏的主循环、UI管理器或AI系统等。在这个示例中，我们可以假设有一个UI管理器，它负责处理玩家的点击事件。</p>
<ol start="6">
<li><strong>客户端（Client）</strong>：</li>
</ol>
<p>客户端通常是游戏的初始化代码或配置部分。在这里，我们创建具体的命令对象，并将其与接收者关联起来。然后，我们将命令对象传递给调用者（如UI管理器）。</p>
<h3 id="命令模式的优点"><a href="#命令模式的优点" class="headerlink" title="命令模式的优点"></a>命令模式的优点</h3><ul>
<li><strong>解耦</strong>：命令模式将请求的执行者与请求本身解耦，使得请求的发送者和接收者可以独立地变化。</li>
<li><strong>可扩展性</strong>：新的命令可以很容易地添加到系统中，而无需修改现有的类。</li>
<li><strong>可撤销&#x2F;重做</strong>：通过实现<code>undo()</code>等方法，可以很容易地支持命令的撤销和重做功能。</li>
<li><strong>队列和日志</strong>：命令对象可以存储在队列中以实现命令的批量执行或延迟执行，也可以存储在日志中以记录游戏的历史状态。</li>
</ul>
<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><ul>
<li>命令模式可能会增加系统的复杂性和开销，因此应谨慎使用。在简单场景中，可能不需要使用命令模式。</li>
<li>在实现命令模式时，要确保正确地管理命令对象的生命周期，以避免内存泄漏等问题。</li>
</ul>
<h3 id="享元模式"><a href="#享元模式" class="headerlink" title="享元模式"></a>享元模式</h3><p>在游戏编程中，享元模式（Flyweight Pattern）是一种用于优化性能的设计模式，它通过共享来避免大量拥有相同内容对象的开销。在游戏开发中，这种模式特别适用于那些需要创建大量相似对象的情况，如玩家角色、怪物、道具等。</p>
<p>享元模式的核心思想是将对象的内部状态（即不随环境改变而改变的属性）和外部状态（即随环境改变而改变的属性）进行区分。通过共享内部状态，可以显著减少对象的数量，从而降低内存消耗和提高性能。</p>
<p>在游戏编程中，享元模式的应用场景可能包括：</p>
<ol>
<li><strong>角色创建</strong>：在大型多人在线游戏（MMO）中，可能存在大量的玩家角色。这些角色可能有很多相同的属性（如种族、职业、等级等），而装备、技能、位置等属性则各不相同。通过享元模式，可以将这些共享的属性存储在一个享元对象中，并为每个角色分配一个包含其特有属性的实例。</li>
<li><strong>怪物生成</strong>：在游戏中，可能需要生成大量的怪物。这些怪物可能具有相同的外观、属性和行为，但位置、状态等属性可能各不相同。通过享元模式，可以共享怪物的内部状态，从而减少内存消耗。</li>
<li><strong>道具管理</strong>：在游戏中，可能存在大量的道具，这些道具可能具有相同的属性（如名称、类型、功能等），但数量、位置等属性可能各不相同。通过享元模式，可以共享道具的内部状态，从而优化内存使用。</li>
</ol>
<p>在实现享元模式时，通常需要定义两个主要类：</p>
<ol>
<li><strong>享元类（Flyweight）</strong>：用于存储对象的内部状态。这个类通常具有一个静态的工厂方法或工厂类来管理享元对象的创建和共享。</li>
<li><strong>上下文类（Context）</strong>：用于存储对象的外部状态。这个类持有享元对象的引用，并提供操作这些对象的方法。当需要操作对象时，上下文类会将享元对象与其外部状态结合起来。</li>
</ol>
<p>需要注意的是，享元模式虽然可以显著优化性能，但也可能增加系统的复杂性。因此，在使用享元模式时，需要权衡其优点和缺点，并根据具体需求进行选择和调整。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;list&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unordered_map&gt;</span>  </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span>  </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="comment">// 享元接口  </span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MonsterFlyweight</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">MonsterFlyweight</span>() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">attack</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">setLocation</span><span class="params">(<span class="type">const</span> std::string&amp; location)</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">const</span> std::string&amp; <span class="title">getLocation</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体的享元类  </span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Monster</span> : <span class="keyword">public</span> MonsterFlyweight &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string monsterType;</span><br><span class="line">    <span class="type">int</span> attackPower;</span><br><span class="line">    std::string location; <span class="comment">// 外部状态通常不应在享元类中直接存储，但为简单起见，这里这样做  </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Monster</span>(<span class="type">const</span> std::string&amp; monsterType, <span class="type">int</span> attackPower)</span><br><span class="line">        : <span class="built_in">monsterType</span>(monsterType), <span class="built_in">attackPower</span>(attackPower) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">attack</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; monsterType &lt;&lt; <span class="string">&quot; monster attacks with power &quot;</span> &lt;&lt; attackPower &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setLocation</span><span class="params">(<span class="type">const</span> std::string&amp; location)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;location = location;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">const</span> std::string&amp; <span class="title">getLocation</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> location;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 享元工厂类  </span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MonsterFactory</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::unordered_map&lt;std::string, std::unique_ptr&lt;MonsterFlyweight&gt;&gt; monsterPool;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">MonsterFlyweight* <span class="title">getMonster</span><span class="params">(<span class="type">const</span> std::string&amp; monsterType, <span class="type">int</span> attackPower)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">auto</span> it = monsterPool.<span class="built_in">find</span>(monsterType);</span><br><span class="line">        <span class="keyword">if</span> (it == monsterPool.<span class="built_in">end</span>()) &#123;</span><br><span class="line">            it = monsterPool.<span class="built_in">emplace</span>(std::piecewise_construct,</span><br><span class="line">                std::forward_as_tuple(monsterType),</span><br><span class="line">                std::forward_as_tuple(std::<span class="built_in">make_unique</span>&lt;Monster&gt;(monsterType, attackPower))).first;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> it-&gt;second.<span class="built_in">get</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 上下文类（用于存储外部状态）  </span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MonsterContext</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    MonsterFlyweight* monster;</span><br><span class="line">    std::string location; <span class="comment">// 外部状态在上下文中存储  </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">MonsterContext</span>(MonsterFlyweight* monster) : <span class="built_in">monster</span>(monster) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setLocation</span><span class="params">(<span class="type">const</span> std::string&amp; location)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;location = location;</span><br><span class="line">        monster-&gt;<span class="built_in">setLocation</span>(location); <span class="comment">// 通知享元更新其位置（这里只是为了演示）  </span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">attack</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        monster-&gt;<span class="built_in">attack</span>();</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Monster is now at &quot;</span> &lt;&lt; location &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码  </span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    MonsterFactory factory;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建并共享享元对象  </span></span><br><span class="line">    MonsterFlyweight* goblin = factory.<span class="built_in">getMonster</span>(<span class="string">&quot;Goblin&quot;</span>, <span class="number">10</span>);</span><br><span class="line">    MonsterFlyweight* orc = factory.<span class="built_in">getMonster</span>(<span class="string">&quot;Orc&quot;</span>, <span class="number">15</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用上下文来设置外部状态并执行操作  </span></span><br><span class="line">    <span class="function">MonsterContext <span class="title">goblinContext</span><span class="params">(goblin)</span></span>;</span><br><span class="line">    goblinContext.<span class="built_in">setLocation</span>(<span class="string">&quot;Cave Entrance&quot;</span>);</span><br><span class="line">    goblinContext.<span class="built_in">attack</span>();</span><br><span class="line"></span><br><span class="line">    <span class="function">MonsterContext <span class="title">orcContext</span><span class="params">(orc)</span></span>;</span><br><span class="line">    orcContext.<span class="built_in">setLocation</span>(<span class="string">&quot;Forest Clearing&quot;</span>);</span><br><span class="line">    orcContext.<span class="built_in">attack</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="状态模式"><a href="#状态模式" class="headerlink" title="状态模式"></a>状态模式</h3><p>在游戏编程中，状态模式（State Pattern）是一种行为设计模式，它允许一个对象在其内部状态改变时改变它的行为。状态模式使得对象看起来好像修改了它的类，但它实际上是通过将对象的行为委托给其当前状态对象来改变其行为的。这提供了一种使行为依赖于对象内部状态变化的解决方案，而不是通过大量的条件语句和复杂的逻辑来管理这些变化。</p>
<p>以下是一个简单的游戏编程中状态模式的示例，假设我们有一个角色（如玩家角色）可以处于不同的状态（如空闲、移动、攻击等）：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 状态基类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">State</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">State</span>() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">handle</span><span class="params">(<span class="keyword">class</span> Character* character)</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 空闲状态</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">IdleState</span> : <span class="keyword">public</span> State &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">handle</span><span class="params">(Character* character)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Character is idle.&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="comment">// 切换到其他状态...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 移动状态</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MoveState</span> : <span class="keyword">public</span> State &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">handle</span><span class="params">(Character* character)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Character is moving.&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="comment">// 角色移动的逻辑...</span></span><br><span class="line">        <span class="comment">// 切换到其他状态...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 攻击状态</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AttackState</span> : <span class="keyword">public</span> State &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">handle</span><span class="params">(Character* character)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Character is attacking.&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="comment">// 角色攻击的逻辑...</span></span><br><span class="line">        <span class="comment">// 切换到其他状态...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 角色类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Character</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    State* state;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Character</span>() : <span class="built_in">state</span>(<span class="keyword">new</span> <span class="built_in">IdleState</span>()) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setState</span><span class="params">(State* newState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">delete</span> state;</span><br><span class="line">        state = newState;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        state-&gt;<span class="built_in">handle</span>(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 其他角色相关的方法...</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Character character;</span><br><span class="line"></span><br><span class="line">    character.<span class="built_in">update</span>(); <span class="comment">// 输出 &quot;Character is idle.&quot;</span></span><br><span class="line"></span><br><span class="line">    character.<span class="built_in">setState</span>(<span class="keyword">new</span> <span class="built_in">MoveState</span>());</span><br><span class="line">    character.<span class="built_in">update</span>(); <span class="comment">// 输出 &quot;Character is moving.&quot;</span></span><br><span class="line"></span><br><span class="line">    character.<span class="built_in">setState</span>(<span class="keyword">new</span> <span class="built_in">AttackState</span>());</span><br><span class="line">    character.<span class="built_in">update</span>(); <span class="comment">// 输出 &quot;Character is attacking.&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 清理动态分配的状态对象（在实际应用中可能需要更复杂的内存管理）</span></span><br><span class="line">    <span class="keyword">delete</span> character.state;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这个例子中，<code>Character</code> 类有一个 <code>State</code> 类型的成员变量 <code>state</code>，它指向当前的状态对象。<code>Character</code> 类有一个 <code>setState</code> 方法来更改其当前状态，以及一个 <code>update</code> 方法来调用当前状态对象的 <code>handle</code> 方法。每个状态类（如 <code>IdleState</code>、<code>MoveState</code>、<code>AttackState</code>）都实现了 <code>handle</code> 方法，该方法定义了当角色处于该状态时应该执行的行为。</p>
<p>通过使用状态模式，我们可以轻松地添加新的状态和行为，而无需修改 <code>Character</code> 类或现有的状态类。这提高了代码的可维护性和可扩展性。</p>
<h3 id="子类沙箱模式"><a href="#子类沙箱模式" class="headerlink" title="子类沙箱模式"></a>子类沙箱模式</h3><ul>
<li>子类沙箱模式（Subclass Sandbox Pattern）是一种设计模式，主要用于在面向对象编程中管理子类与基类之间的行为和操作。该模式的核心思想是将一些通用的操作或行为定义为基类的方法，而子类则通过重载或实现这些方法来实现特定的行为。通过这种方式，可以将所有与这些操作相关的耦合都聚集到基类，从而使子类与其他类更加独立。</li>
</ul>
<p>​        子类沙箱模式通常适用于以下情况：</p>
<ol>
<li>有一个带有大量子类的基类。</li>
<li>基类能够提供所有子类可能需要执行的操作集合。</li>
<li>在子类之间有重叠的代码，你想让它们之间更容易地共享代码。</li>
<li>你想使这些继承类和程序的其他代码之间的耦合最小化。</li>
</ol>
<p>在子类沙箱模式中，基类通常包含一些抽象方法或虚方法，这些方法定义了子类需要实现的行为。子类通过重载这些方法来实现自己的特定行为。同时，基类还可以包含一些受保护的（protected）方法，这些方法提供了一些子类在实现特定行为时需要调用的操作。这些受保护的方法可以被视为“沙箱”中的安全原语，子类可以在其中安全地执行特定的操作。</p>
<p>子类沙箱模式的优点包括：</p>
<ol>
<li>减少代码冗余：通过在基类中定义通用的操作，可以避免在子类中重复编写相同的代码。</li>
<li>提高代码的可维护性：由于所有的耦合都聚集到基类，子类与其他类之间的依赖关系变得更加清晰和简单，从而提高了代码的可维护性。</li>
<li>促进代码复用：子类可以通过继承基类来重用基类中定义的操作，从而提高了代码的复用性。</li>
</ol>
<p>然而，子类沙箱模式也存在一些缺点。例如，当基类包含大量的方法时，它可能会变得庞大且难以维护。此外，如果子类需要访问基类中的受保护方法，则可能会破坏封装性并增加类之间的耦合度。因此，在使用子类沙箱模式时，需要权衡其优缺点并根据具体的应用场景来选择是否使用该模式。</p>
<ul>
<li><p>在C++中，子类沙箱模式的一个示例可以通过创建一个基类，该类包含一些虚函数（表示子类可能需要实现的行为），以及一个或多个受保护的方法（表示子类可以安全调用的操作）。子类将继承这个基类，并根据需要重载虚函数来实现特定的行为。</p>
<p>以下是一个简单的C++示例，展示了子类沙箱模式的概念：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 基类，包含虚函数和受保护的方法</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Base</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// 虚函数，子类需要实现</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">executeAction</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="comment">// 受保护的方法，子类可以调用</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">protectedOperation</span><span class="params">(<span class="type">const</span> std::string&amp; message)</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Protected operation called with message: &quot;</span> &lt;&lt; message &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子类，继承基类并重载虚函数</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Derived</span> : <span class="keyword">public</span> Base &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// 重载基类中的虚函数</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">executeAction</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Derived class action starting...&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="comment">// 调用基类中的受保护方法</span></span><br><span class="line">        <span class="built_in">protectedOperation</span>(<span class="string">&quot;Hello from Derived!&quot;</span>);</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Derived class action finished.&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 主函数，用于测试</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 创建子类对象</span></span><br><span class="line">    Derived derivedObj;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 调用子类对象的虚函数，该函数会调用基类中的受保护方法</span></span><br><span class="line">    derivedObj.<span class="built_in">executeAction</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这个示例中，<code>Base</code> 类是一个基类，它包含一个纯虚函数 <code>executeAction()</code> 和一个受保护的方法 <code>protectedOperation()</code>。<code>Derived</code> 类是 <code>Base</code> 的子类，它重载了 <code>executeAction()</code> 函数并在其中调用了基类的 <code>protectedOperation()</code> 方法。在 <code>main()</code> 函数中，我们创建了一个 <code>Derived</code> 类的对象，并调用了它的 <code>executeAction()</code> 方法，该方法会输出一些信息并调用基类的受保护方法。</p>
<p>请注意，这个示例主要是为了演示子类沙箱模式的概念，而不是一个完整的应用程序。在实际的应用程序中，基类和子类可能会包含更多的属性和方法，并且它们之间的关系可能会更加复杂。</p>
</li>
</ul>
<h3 id="工厂模式"><a href="#工厂模式" class="headerlink" title="工厂模式"></a>工厂模式</h3><h4 id="函数工厂"><a href="#函数工厂" class="headerlink" title="函数工厂"></a>函数工厂</h4><ul>
<li><p>在工厂类声明一个返回类的实例的函数</p>
</li>
<li><p>这段代码创建了一个怪物基类,然后通过继承实现了不同怪物,然后创建工厂来返回不同怪物的实例</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;list&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">//怪物的基类</span></span><br><span class="line"><span class="keyword">class</span> 怪物基类</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    怪物基类(string p_name):<span class="built_in">name</span>(p_name) &#123;&#125;;</span><br><span class="line">    <span class="keyword">virtual</span> ~怪物基类() &#123;&#125;;</span><br><span class="line">    <span class="type">void</span> 共同方法()</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; name &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    string name;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>&#x2F;&#x2F;怪物实现,都继承之怪物基类<br>class 野猪 :public 怪物基类<br>{<br>public:</p>
<pre><code>野猪(string p_name) :怪物基类(p_name) &#123;&#125;;
~野猪() &#123;&#125;;
</code></pre>
<p>};</p>
<p>class 黑熊 :public 怪物基类<br>{<br>public:</p>
<pre><code>黑熊(string p_name) :怪物基类(p_name) &#123;&#125;;
~黑熊() &#123;&#125;;
</code></pre>
<p>};</p>
<p>class 蜘蛛 :public 怪物基类<br>{<br>public:</p>
<pre><code>蜘蛛(string p_name) :怪物基类(p_name) &#123;&#125;;
~蜘蛛() &#123;&#125;;
</code></pre>
<p>};</p>
<p>&#x2F;&#x2F;声明一个怪物工厂,用于生产怪物<br>class 怪物工厂<br>{<br>public:</p>
<pre><code>怪物基类* 创建野猪(string p_name)
&#123;
    return new 野猪(p_name);
&#125;
怪物基类* 创建黑熊(string p_name)
&#123;
    return new 野猪(p_name);
&#125;
怪物基类* 创建蜘蛛(string p_name)
&#123;
    return new 野猪(p_name);
&#125;
</code></pre>
<p>};</p>
<p>int main() {</p>
<pre><code>怪物工厂 工厂;
怪物基类* new野猪=工厂.创建野猪(&quot;讨之助&quot;);
怪物基类* new黑熊 = 工厂.创建黑熊(&quot;小明&quot;);
怪物基类* new蜘蛛 = 工厂.创建蜘蛛(&quot;假面骑士&quot;);
new野猪-&gt;共同方法();
new黑熊-&gt;共同方法();
new蜘蛛-&gt;共同方法();

return 0;
</code></pre>
<p>}</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line">![www](/img/函数工厂模式.png)</span><br><span class="line"></span><br><span class="line">#### 抽象工厂</span><br><span class="line"></span><br><span class="line">+ 通过抽象工厂和抽象产品生产一系列的产品,比图我要进货手机,有安卓和苹果等品牌,我就需要这个手机工厂生产了这两种品牌的手机</span><br><span class="line"></span><br><span class="line">```cpp</span><br><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &lt;list&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">//产品抽象类,所以苹果产品都继承这个类</span><br><span class="line">class 苹果</span><br><span class="line">&#123;</span><br><span class="line">public:</span><br><span class="line">  virtual ~苹果() &#123;&#125;;</span><br><span class="line">  virtual void 输出产品名字()=0;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">//苹果电脑实现</span><br><span class="line">class 苹果电脑 :public 苹果</span><br><span class="line">&#123;</span><br><span class="line">public:</span><br><span class="line">  ~苹果电脑() &#123;&#125;;</span><br><span class="line">  void 输出产品名字()</span><br><span class="line">  &#123;</span><br><span class="line">      cout &lt;&lt; &quot;苹果电脑&quot; &lt;&lt; endl;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">//苹果手机实现</span><br><span class="line">class 苹果手机 :public 苹果</span><br><span class="line">&#123;</span><br><span class="line">public:</span><br><span class="line">  ~苹果手机() &#123;&#125;;</span><br><span class="line">  void 输出产品名字()</span><br><span class="line">  &#123;</span><br><span class="line">      cout &lt;&lt; &quot;苹果手机&quot; &lt;&lt; endl;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">//安卓产品抽象类,索引安卓产品都继承这个类</span><br><span class="line">class 安卓</span><br><span class="line">&#123;</span><br><span class="line">public:</span><br><span class="line">  virtual ~安卓() &#123;&#125;;</span><br><span class="line">  virtual void 输出产品名字()=0;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">//安卓点啊弄实现</span><br><span class="line">class 安卓电脑 :public 安卓</span><br><span class="line">&#123;</span><br><span class="line">public:</span><br><span class="line">  ~安卓电脑() &#123;&#125;;</span><br><span class="line">  void 输出产品名字()</span><br><span class="line">  &#123;</span><br><span class="line">      cout &lt;&lt; &quot;安卓电脑&quot; &lt;&lt; endl;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">//安卓手机实现</span><br><span class="line">class 安卓手机 :public 安卓</span><br><span class="line">&#123;</span><br><span class="line">public:</span><br><span class="line">  ~安卓手机() &#123;&#125;;</span><br><span class="line">  void 输出产品名字()</span><br><span class="line">  &#123;</span><br><span class="line">      cout &lt;&lt; &quot;安卓手机&quot; &lt;&lt; endl;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">//工厂抽象类</span><br><span class="line">class 数码工厂</span><br><span class="line">&#123;</span><br><span class="line">public:</span><br><span class="line">  virtual ~数码工厂() &#123;&#125;;</span><br><span class="line">  virtual 安卓* 生产安卓产品() = 0;</span><br><span class="line">  virtual 苹果* 生产苹果产品() = 0;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">//工厂实现,可以生产各种品牌的电脑</span><br><span class="line">class 电脑工厂 :public 数码工厂</span><br><span class="line">&#123;</span><br><span class="line">public:</span><br><span class="line">  ~电脑工厂() &#123;&#125;;</span><br><span class="line">  安卓* 生产安卓产品()</span><br><span class="line">  &#123;</span><br><span class="line">      return new  安卓电脑;</span><br><span class="line">  &#125;</span><br><span class="line">  苹果* 生产苹果产品()</span><br><span class="line">  &#123;</span><br><span class="line">      return new 苹果电脑;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">//工厂实现,可以生产各种品牌的手机</span><br><span class="line">class 手机工厂 :public 数码工厂</span><br><span class="line">&#123;</span><br><span class="line">public:</span><br><span class="line">  ~手机工厂() &#123;&#125;;</span><br><span class="line">  安卓* 生产安卓产品()</span><br><span class="line">  &#123;</span><br><span class="line">      return new  安卓手机;</span><br><span class="line">  &#125;</span><br><span class="line">  苹果* 生产苹果产品()</span><br><span class="line">  &#123;</span><br><span class="line">      return new 苹果手机;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">int main() &#123;</span><br><span class="line"></span><br><span class="line">  //我需要生产电脑</span><br><span class="line">  电脑工厂* 电脑商 = new 电脑工厂;</span><br><span class="line">  苹果* 苹果pro = 电脑商-&gt;生产苹果产品();</span><br><span class="line">  安卓* 安卓平板 = 电脑商-&gt;生产安卓产品();</span><br><span class="line">  苹果pro-&gt;输出产品名字();</span><br><span class="line">  安卓平板-&gt;输出产品名字();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  //我需要手机</span><br><span class="line">  手机工厂* 手机商 = new 手机工厂();</span><br><span class="line">  苹果* 苹果15 = 手机商-&gt;生产苹果产品();</span><br><span class="line">  苹果15-&gt;输出产品名字();</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://files.wujicode.cn/w/open/dnf_universe_app/r4w7VxTy.jpeg&quot;" data-lazy-src="/%5Cimg%5C%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F.png" alt="抽象工厂模式"></p>
<ul>
<li>怪物工厂</li>
<li>通过抽象怪物工厂创建一系列的类</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://files.wujicode.cn/w/open/dnf_universe_app/r4w7VxTy.jpeg&quot;" data-lazy-src="/%5Cimg%5C%E6%80%AA%E7%89%A9%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F.png" alt="抽象工厂模式"></p>
<p>在游戏开发中，抽象工厂模式（Abstract Factory Pattern）的使用通常出现在以下场景：</p>
<ol>
<li><strong>需要创建多个相关或相互依赖的对象时</strong>：抽象工厂模式允许你定义一个接口来创建一组相关的对象，而无需指定它们的具体类。这在游戏开发中很常见，因为游戏通常包含许多相互关联的对象，如角色、武器、装备等。</li>
<li><strong>需要处理多个产品族时</strong>：游戏可能会根据不同的版本、难度或模式而有不同的产品族（即一组相关的对象）。例如，一个游戏可能有不同的角色族（如战士、法师、盗贼等），每个角色族都有自己的武器、装备和技能。使用抽象工厂模式，你可以为每个角色族创建一个具体的工厂，该工厂负责创建该角色族所需的所有对象。</li>
<li><strong>需要隐藏对象的创建细节时</strong>：在游戏开发中，你可能希望隐藏对象的创建细节，以便在不影响客户端代码的情况下更改对象的实现。抽象工厂模式允许你定义一个接口来创建对象，而客户端代码只需与该接口交互，而无需知道对象的实际创建过程。</li>
<li><strong>需要提高系统的可扩展性和可维护性时</strong>：随着游戏的发展，你可能需要添加新的角色、武器或装备。使用抽象工厂模式，你可以轻松地添加新的产品族或产品，而无需修改现有的客户端代码。这有助于提高系统的可扩展性和可维护性。</li>
</ol>
<p>总之，抽象工厂模式在游戏开发中是一种非常有用的设计模式，它可以帮助你创建和管理一组相关的对象，并隐藏对象的创建细节。如果你的游戏需要处理多个产品族或需要提高系统的可扩展性和可维护性，那么抽象工厂模式可能是一个很好的选择。</p>
<p>在游戏开发中，抽象工厂模式的一个典型应用例子是创建不同类型的角色（如战士、法师）以及他们各自的装备。以下是一个简化的例子来说明这一点：</p>
<p>首先，定义一些接口来表示不同类型的角色和装备：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 角色接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Character</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Character</span>() &#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">equip</span><span class="params">()</span> </span>= <span class="number">0</span>; <span class="comment">// 装备武器和装备</span></span><br><span class="line">    <span class="comment">// 其他角色方法...</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 战士接口和具体实现</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Warrior</span> : <span class="keyword">public</span> Character &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">equip</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Warrior equips sword and shield.&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 其他战士方法...</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 法师接口和具体实现</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mage</span> : <span class="keyword">public</span> Character &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">equip</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Mage equips staff and robe.&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 其他法师方法...</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 武器接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Weapon</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Weapon</span>() &#123;&#125;</span><br><span class="line">    <span class="comment">// 武器的方法...</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 战士武器和法师武器的具体实现（略）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 装备接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Armor</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Armor</span>() &#123;&#125;</span><br><span class="line">    <span class="comment">// 装备的方法...</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 战士装备和法师装备的具体实现（略）</span></span><br></pre></td></tr></table></figure>

<p>接下来，定义一个抽象工厂接口来创建角色和装备：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象工厂接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CharacterFactory</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">CharacterFactory</span>() &#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> Character* <span class="title">createWarrior</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> Character* <span class="title">createMage</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> Weapon* <span class="title">createWarriorWeapon</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> Weapon* <span class="title">createMageWeapon</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> Armor* <span class="title">createWarriorArmor</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> Armor* <span class="title">createMageArmor</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>然后，为每个产品族（如战士和法师）创建一个具体的工厂类：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 战士工厂</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WarriorFactory</span> : <span class="keyword">public</span> CharacterFactory &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">Character* <span class="title">createWarrior</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123; <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Warrior</span>(); &#125;</span><br><span class="line">    <span class="function">Weapon* <span class="title">createWarriorWeapon</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123; <span class="comment">/* 返回战士武器的实例 */</span> &#125;</span><br><span class="line">    <span class="function">Armor* <span class="title">createWarriorArmor</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123; <span class="comment">/* 返回战士装备的实例 */</span> &#125;</span><br><span class="line">    <span class="comment">// 其他法师相关的方法在这里不需要实现</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 法师工厂</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MageFactory</span> : <span class="keyword">public</span> CharacterFactory &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">Character* <span class="title">createMage</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123; <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Mage</span>(); &#125;</span><br><span class="line">    <span class="function">Weapon* <span class="title">createMageWeapon</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123; <span class="comment">/* 返回法师武器的实例 */</span> &#125;</span><br><span class="line">    <span class="function">Armor* <span class="title">createMageArmor</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123; <span class="comment">/* 返回法师装备的实例 */</span> &#125;</span><br><span class="line">    <span class="comment">// 其他战士相关的方法在这里不需要实现</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>最后，在游戏的主逻辑或某个客户端代码中，你可以使用这些工厂来创建角色和装备：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    CharacterFactory* factory;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建战士族</span></span><br><span class="line">    factory = <span class="keyword">new</span> <span class="built_in">WarriorFactory</span>();</span><br><span class="line">    Character* warrior = factory-&gt;<span class="built_in">createWarrior</span>();</span><br><span class="line">    warrior-&gt;<span class="built_in">equip</span>(); <span class="comment">// 输出 &quot;Warrior equips sword and shield.&quot;</span></span><br><span class="line">    <span class="comment">// ... 其他战士相关的操作 ...</span></span><br><span class="line">    <span class="keyword">delete</span> warrior;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建法师族</span></span><br><span class="line">    <span class="keyword">delete</span> factory; <span class="comment">// 先删除前一个工厂实例</span></span><br><span class="line">    factory = <span class="keyword">new</span> <span class="built_in">MageFactory</span>();</span><br><span class="line">    Character* mage = factory-&gt;<span class="built_in">createMage</span>();</span><br><span class="line">    mage-&gt;<span class="built_in">equip</span>(); <span class="comment">// 输出 &quot;Mage equips staff and robe.&quot;</span></span><br><span class="line">    <span class="comment">// ... 其他法师相关的操作 ...</span></span><br><span class="line">    <span class="keyword">delete</span> mage;</span><br><span class="line">    <span class="keyword">delete</span> factory;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个例子展示了如何使用抽象工厂模式来创建和管理游戏中不同类型的角色和装备。每个具体的工厂类负责创建它所属产品族的对象，从而实现了创建过程的封装和隔离。这有助于保持代码的清晰性和可维护性，并允许在不影响客户端代码的情况下添加新的产品族或修改现有产品族的实现。</p>
<h1 id="装配系统"><a href="#装配系统" class="headerlink" title="装配系统"></a>装配系统</h1><ul>
<li><p>所需节点Node3D,Marker3D作为部件放置的位置,方便调整位置</p>
</li>
<li><pre><code class="language-gdscript">@tool
extends Node3D
class_name 装备模型

@onready var 枪身: Marker3D = $&quot;枪身&quot;
@onready var 枪管: Marker3D = $&quot;枪管&quot;
@onready var 瞄准仪: Marker3D = $&quot;瞄准仪&quot;

#资源,每当资源变更时刷新配件节点
@export var 枪身资源:武器资源类:
    get: 
        return 枪身资源
    set(value):
        if value==枪身资源:
            return
        枪身资源=value
        武器资源更新()

@export var 枪管资源:武器资源类:
    get: 
        return 枪管资源
    set(value):
        if value==枪管资源:
            return
        枪管资源=value
        武器资源更新()

@export var 瞄准仪资源:武器资源类:
    get: 
        return 瞄准仪资源
    set(value):
        if value==瞄准仪资源:
            return
        瞄准仪资源=value
        武器资源更新()

# Called every frame. &#39;delta&#39; is the elapsed time since the previous frame.
func _process(delta: float) -&gt; void:
    pass
func 武器资源更新():
    #初始化节点,将配件全部清除
    if(枪身 and 枪身.get_child_count()&gt;0):
        枪身.get_child(0).queue_free()
    if(枪管 and 枪管.get_child_count()&gt;0):
        枪管.get_child(0).queue_free()
    if(瞄准仪 and 瞄准仪.get_child_count()&gt;0):
        瞄准仪.get_child(0).queue_free()

    #检查资源是否存在
    if 枪身!=null and 枪身资源:
        var 武器场景:PackedScene=load(枪身资源.武器场景路径)
        枪身.add_child(武器场景.instantiate())
    else: #如果武器不存在,初始化其他配件
        枪管资源=null
        瞄准仪资源=null

    #检查其他配件,如果存在则添加到节点树
    if 枪管!=null and 枪管资源:
        var 枪管场景:PackedScene=load(枪管资源.武器场景路径)
        枪管.add_child(枪管场景.instantiate())

    if 瞄准仪!=null and 瞄准仪资源:
        var 瞄准仪场景:PackedScene=load(瞄准仪资源.武器场景路径)
        瞄准仪.add_child(瞄准仪场景.instantiate())


+ 背包,负责更新装备
  
  
  extends Control
  
  @export var 武器展示场景: 装备模型
  @export var 武器装备场景: 装备模型
  @export var 物品背包:Array[Resource]
  
  # Called when the node enters the scene tree for the first time.
  func _ready() -&gt; void:
      pass # Replace with function body.
  
  
  # Called every frame. &#39;delta&#39; is the elapsed time since the previous frame.
  
  func _process(delta: float) -&gt; void:
  
      更新装备(武器展示场景);
      更新装备(武器装备场景);
      pass
  
  func 更新装备(data:装备模型):
  
      if data:
          data.枪身资源=物品背包[0]
          data.枪管资源=物品背包[1]
          data.瞄准仪资源=物品背包[2]
  
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">  </span><br></pre></td></tr></table></figure>
  extends PanelContainer
    
    @onready var texture_rect: TextureRect
    
    @onready var 背包: Control = $&quot;../../..&quot;
    @export var 索引:int=0
    # Called when the node enters the scene tree for the first time.
    func _ready() -&gt; void:
        texture_rect=get_node(&quot;TextureRect&quot;)
        pass # Replace with function body.
    
    # Called every frame. &#39;delta&#39; is the elapsed time since the previous frame.
    func _process(delta: float) -&gt; void:
        if 背包.物品背包[索引]:
            texture_rect.texture=背包.物品背包[索引].icon
        else:
            texture_rect.texture=preload(&quot;res://Icon/空纹理.png&quot;)
        pass
    
    func _get_drag_data(position):
        if 背包.物品背包[索引]:
            var cpb =TextureRect.new()
            cpb.texture=背包.物品背包[索引].icon
            set_drag_preview(cpb)
            return 背包.物品背包[索引]
    
    func _can_drop_data(position, data):
        # 检查是否为武器基类
        if data is Resource:
            return true
        else:
            return false
    #数据处理
    func _drop_data(position, data):
        print(data)
        if 背包.物品背包[索引]==null:
            var ite=背包.物品背包.find(data)
            背包.物品背包
    [索引]=data
            背包.物品背包[ite]=null
        else :
            var ite=背包.物品背包.find(data)
            var temp=背包.物品背包[索引]
            背包.物品背包[索引]=data
            背包.物品背包[ite]=temp
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># 游戏能力系统</span><br><span class="line">```cpp</span><br><span class="line">#ifndef TABILITY_H</span><br><span class="line">#define TABILITY_H</span><br><span class="line"></span><br><span class="line">#include &lt;godot_cpp/classes/node.hpp&gt;</span><br><span class="line"></span><br><span class="line">//#include &lt;godot_cpp/core/class_db.hpp&gt;</span><br><span class="line">#include &lt;godot_cpp/variant/utility_functions.hpp&gt;  //输出字符串用</span><br><span class="line">using namespace godot;</span><br><span class="line"></span><br><span class="line">//#define VARIANT_ARG_MAX 8</span><br><span class="line">//#define VARIANT_ARG_DECLARE const Variant &amp;p_arg1, const Variant &amp;p_arg2, const Variant &amp;p_arg3, const Variant &amp;p_arg4, const //Variant &amp;p_arg5, const Variant &amp;p_arg6, const Variant &amp;p_arg7, const Variant &amp;p_arg8</span><br><span class="line"></span><br><span class="line">class AbilitySystem : public Node</span><br><span class="line">&#123;</span><br><span class="line">    GDCLASS(AbilitySystem, Node);</span><br><span class="line"></span><br><span class="line">private:</span><br><span class="line">protected:</span><br><span class="line">    static void _bind_methods();</span><br><span class="line">public:</span><br><span class="line">    AbilitySystem();</span><br><span class="line">    ~AbilitySystem();</span><br><span class="line">&#125;;</span><br><span class="line">#endif // TABILITY_H</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**************************************************************************/</span></span><br><span class="line"><span class="comment">/*  threen.cpp                                                            */</span></span><br><span class="line"><span class="comment">/**************************************************************************/</span></span><br><span class="line"><span class="comment">/*                         This file is part of:                          */</span></span><br><span class="line"><span class="comment">/*                             GODOT ENGINE                               */</span></span><br><span class="line"><span class="comment">/*                        https://godotengine.org                         */</span></span><br><span class="line"><span class="comment">/**************************************************************************/</span></span><br><span class="line"><span class="comment">/* Copyright (c) 2014-present Godot Engine contributors (see AUTHORS.md). */</span></span><br><span class="line"><span class="comment">/* Copyright (c) 2007-2014 Juan Linietsky, Ariel Manzur.                  */</span></span><br><span class="line"><span class="comment">/*                                                                        */</span></span><br><span class="line"><span class="comment">/* Permission is hereby granted, free of charge, to any person obtaining  */</span></span><br><span class="line"><span class="comment">/* a copy of this software and associated documentation files (the        */</span></span><br><span class="line"><span class="comment">/* &quot;Software&quot;), to deal in the Software without restriction, including    */</span></span><br><span class="line"><span class="comment">/* without limitation the rights to use, copy, modify, merge, publish,    */</span></span><br><span class="line"><span class="comment">/* distribute, sublicense, and/or sell copies of the Software, and to     */</span></span><br><span class="line"><span class="comment">/* permit persons to whom the Software is furnished to do so, subject to  */</span></span><br><span class="line"><span class="comment">/* the following conditions:                                              */</span></span><br><span class="line"><span class="comment">/*                                                                        */</span></span><br><span class="line"><span class="comment">/* The above copyright notice and this permission notice shall be         */</span></span><br><span class="line"><span class="comment">/* included in all copies or substantial portions of the Software.        */</span></span><br><span class="line"><span class="comment">/*                                                                        */</span></span><br><span class="line"><span class="comment">/* THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,        */</span></span><br><span class="line"><span class="comment">/* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF     */</span></span><br><span class="line"><span class="comment">/* MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. */</span></span><br><span class="line"><span class="comment">/* IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY   */</span></span><br><span class="line"><span class="comment">/* CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,   */</span></span><br><span class="line"><span class="comment">/* TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE      */</span></span><br><span class="line"><span class="comment">/* SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.                 */</span></span><br><span class="line"><span class="comment">/**************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;public/AbilitySystem.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//#include &quot;easing_equations.h&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;godot_cpp/core/class_db.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;godot_cpp/variant/utility_functions.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> godot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> AbilitySystem::_bind_methods()</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">AbilitySystem::<span class="built_in">AbilitySystem</span>() &#123;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">AbilitySystem::~<span class="built_in">AbilitySystem</span>()</span><br><span class="line">&#123;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://files.wujicode.cn/w/open/dnf_universe_app/r4w7VxTy.jpeg&quot;" data-lazy-src="/img/touxiang.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://files.wujicode.cn/w/open/dnf_universe_app/r4w7VxTy.jpeg&quot;" data-lazy-src="/img/touxiang.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">凝雨</div><div class="post-copyright__author_desc">人生得意须尽欢，莫使金樽空对月。</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://example.com/2025/03/15/%E6%88%88%E5%A4%9A/GDScript/Gdextension/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://example.com/2025/03/15/%E6%88%88%E5%A4%9A/GDScript/Gdextension/')">Gdextension</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="/img/ds.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://files.wujicode.cn/w/open/dnf_universe_app/r4w7VxTy.jpeg&quot;" data-lazy-src="/img/ds.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/ds.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://files.wujicode.cn/w/open/dnf_universe_app/r4w7VxTy.jpeg&quot;" data-lazy-src="/img/ds.png" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://example.com/2025/03/15/%E6%88%88%E5%A4%9A/GDScript/Gdextension/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=Gdextension&amp;url=http://example.com/2025/03/15/%E6%88%88%E5%A4%9A/GDScript/Gdextension/&amp;pic=/img/ww/D003.png" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__category-list"><a class="post-meta__box__categoryes" href="/categories/godot/"><span class="categoryes-punctuation"> <i class="anzhiyufont anzhiyu-icon-inbox"></i></span>godot<span class="categoryesPageCount">11</span></a></div><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/%E5%AD%A6%E4%B9%A0/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>学习<span class="tagsPageCount">35</span></a></div></div><div class="post_share"><div class="social-share" data-image="https://files.wujicode.cn/w/open/dnf_universe_app/8n6PdXzn.jpg?_r_=92093b14-daeb-09da-9821-30304a9238ca" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2025/03/15/%E6%88%88%E5%A4%9A/CSharp/CS%E6%88%88%E5%A4%9A%E6%9D%82%E9%A1%B9/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://files.wujicode.cn/w/open/dnf_universe_app/r4w7VxTy.jpeg&quot;" data-lazy-src="https://vfiles.gtimg.cn/wuji_open/wupload/dnf_universe_data.picture_info/30b81227_k7iSWY_8Ks1.jpg?_r_=20c9e53f-972c-ee25-e945-b2536edc07aa" onerror="onerror=null;src='https://files.wujicode.cn/w/open/dnf_universe_app/r4w7VxTy.jpeg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">C#杂项</div></div></a></div><div class="next-post pull-right"><a href="/2025/03/15/%E6%88%88%E5%A4%9A/GDScript/godot%E5%9F%BA%E7%A1%80/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://files.wujicode.cn/w/open/dnf_universe_app/r4w7VxTy.jpeg&quot;" data-lazy-src="/img/ww/D003.png" onerror="onerror=null;src='https://files.wujicode.cn/w/open/dnf_universe_app/r4w7VxTy.jpeg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">godot基础</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2025/03/15/cpp/C++%E6%95%B0%E7%BB%84/" title="c++数组"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://files.wujicode.cn/w/open/dnf_universe_app/r4w7VxTy.jpeg&quot;" data-lazy-src="https://files.wujicode.cn/w/open/dnf_universe_app/qRlN5U00.jpg?_r_=724ea815-09e4-6c48-ec95-dfa8f3c89e39" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-03-15</div><div class="title">c++数组</div></div></a></div><div><a href="/2025/03/15/cpp/CMake/" title="Cmake"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://files.wujicode.cn/w/open/dnf_universe_app/r4w7VxTy.jpeg&quot;" data-lazy-src="https://files.wujicode.cn/w/open/dnf_universe_app/PklBdp0O.jpg?_r_=e0febaa0-2a23-fe02-9951-87ad8a730ed0" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-03-15</div><div class="title">Cmake</div></div></a></div><div><a href="/2025/03/15/cpp/cpp%E5%9F%BA%E7%A1%80/" title="CPP基础"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://files.wujicode.cn/w/open/dnf_universe_app/r4w7VxTy.jpeg&quot;" data-lazy-src="https://vfiles.gtimg.cn/wuji_open/wupload/dnf_universe_data.picture_info/30b81227_-i6IfCke6si.jpg?_r_=e45ac46f-e9ae-460b-8678-f4542123f6b2" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-03-15</div><div class="title">CPP基础</div></div></a></div><div><a href="/2025/03/15/cpp/cpp%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" title="cpp数据结构"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://files.wujicode.cn/w/open/dnf_universe_app/r4w7VxTy.jpeg&quot;" data-lazy-src="https://files.wujicode.cn/w/open/dnf_universe_app/8n6PdXzn.jpg?_r_=a0c1bc36-d4aa-f585-3b37-8f164af385e5" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-03-15</div><div class="title">cpp数据结构</div></div></a></div><div><a href="/2025/03/15/cpp/cpp%E6%A8%A1%E6%9D%BF/" title="cpp模板"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://files.wujicode.cn/w/open/dnf_universe_app/r4w7VxTy.jpeg&quot;" data-lazy-src="https://files.wujicode.cn/w/open/dnf_universe_app/rxIcYQoH.jpg?_r_=aa8d12c5-4688-c4c4-577a-199c7e78ed7e" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-03-15</div><div class="title">cpp模板</div></div></a></div><div><a href="/2025/03/15/cpp/inGUI/" title="ImGUI"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://files.wujicode.cn/w/open/dnf_universe_app/r4w7VxTy.jpeg&quot;" data-lazy-src="https://files.wujicode.cn/w/open/dnf_universe_app/PklBdp0O.jpg?_r_=8c95c63e-9abd-9218-313a-6d04f9e1e619" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-03-15</div><div class="title">ImGUI</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> Comment</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div><div class="comment-switch"><span class="first-comment">Twikoo</span><span id="switch-btn"></span><span class="second-comment">Waline</span></div><div class="comment-tips" id="comment-tips"><span>✅ 你无需删除空行，直接评论以获取最佳展示效果</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div><div><div id="waline-wrap"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://files.wujicode.cn/w/open/dnf_universe_app/r4w7VxTy.jpeg&quot;" data-lazy-src="/img/touxiang.jpg" onerror="this.onerror=null;this.src='https://files.wujicode.cn/w/open/dnf_universe_app/r4w7VxTy.jpeg'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://files.wujicode.cn/w/open/dnf_universe_app/r4w7VxTy.jpeg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" alt="status"/></div></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">这有关于<b style="color:#fff">产品、设计、开发</b>相关的问题和看法，还有<b style="color:#fff">文章翻译</b>和<b style="color:#fff">分享</b>。</div><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">相信你可以在这里找到对你有用的<b style="color:#fff">知识</b>和<b style="color:#fff">教程</b>。</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">凝雨</h1><div class="author-info__desc">人生得意须尽欢，莫使金樽空对月。</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/Luojiangbao015" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/253251579" target="_blank" title="BiliBili"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a></div></div></div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://bu.dusays.com/2023/05/13/645fa415e8694.png) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%BA%90%E7%A0%81"><span class="toc-number">1.</span> <span class="toc-text">源码</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF"><span class="toc-number">1.1.</span> <span class="toc-text">模板</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bind-methods"><span class="toc-number">1.2.</span> <span class="toc-text">_bind_methods()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%E5%86%8C%E5%B1%9E%E6%80%A7"><span class="toc-number">1.3.</span> <span class="toc-text">注册属性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A3%B0%E6%98%8E-%E6%9E%9A%E4%B8%BE-Flag-%E5%B8%B8%E9%87%8F"><span class="toc-number">1.4.</span> <span class="toc-text">声明:枚举,Flag,常量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%A1%E5%8F%B7"><span class="toc-number">1.5.</span> <span class="toc-text">信号</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E7%BB%84"><span class="toc-number">1.6.</span> <span class="toc-text">数组</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.7.</span> <span class="toc-text">实例对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B0%83%E7%94%A8%E5%8D%95%E4%BE%8B"><span class="toc-number">1.8.</span> <span class="toc-text">调用单例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%87%8D%E5%86%99%E8%99%9A%E5%87%BD%E6%95%B0"><span class="toc-number">1.9.</span> <span class="toc-text">重写虚函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ADD-PROPERTY%E7%9A%84%E7%94%A8%E6%B3%95"><span class="toc-number">1.10.</span> <span class="toc-text">ADD_PROPERTY的用法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#enum-PropertyHint"><span class="toc-number">1.10.0.1.</span> <span class="toc-text">enum PropertyHint</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#enum-Type"><span class="toc-number">1.10.0.2.</span> <span class="toc-text">enum Type</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Scons"><span class="toc-number">2.</span> <span class="toc-text">Scons</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">2.1.</span> <span class="toc-text">配置文件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Gdextension"><span class="toc-number">3.</span> <span class="toc-text">Gdextension</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-1"><span class="toc-number">3.1.</span> <span class="toc-text">配置文件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%BA%90%E7%A0%81"><span class="toc-number">4.</span> <span class="toc-text">实现源码</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2D"><span class="toc-number">4.1.</span> <span class="toc-text">2D</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%A7%BB%E5%8A%A8"><span class="toc-number">4.1.1.</span> <span class="toc-text">基础移动</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%AA%E7%89%A9%E8%BF%BD%E8%B8%AA%E7%8E%A9%E5%AE%B6"><span class="toc-number">4.1.2.</span> <span class="toc-text">怪物追踪玩家</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9A%B4%E5%87%BB%E5%85%AC%E5%BC%8F"><span class="toc-number">4.1.3.</span> <span class="toc-text">暴击公式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3D"><span class="toc-number">4.2.</span> <span class="toc-text">3D</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%A7%BB%E5%8A%A8-1"><span class="toc-number">4.2.1.</span> <span class="toc-text">基础移动</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%95%E4%BE%8B"><span class="toc-number">4.3.</span> <span class="toc-text">单例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E7%B3%BB%E7%BB%9F"><span class="toc-number">4.3.1.</span> <span class="toc-text">存储系统</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GUI"><span class="toc-number">4.4.</span> <span class="toc-text">GUI</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%89%E9%92%AE"><span class="toc-number">4.4.1.</span> <span class="toc-text">按钮</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%92%E4%BB%B6"><span class="toc-number">4.5.</span> <span class="toc-text">插件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%83%8C%E5%8C%85"><span class="toc-number">4.5.1.</span> <span class="toc-text">背包</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.</span> <span class="toc-text">设计模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-number">5.1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.2.</span> <span class="toc-text">命令模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84"><span class="toc-number">5.2.1.</span> <span class="toc-text">命令模式的基本结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B8%B8%E6%88%8F%E7%BC%96%E7%A8%8B%E4%B8%AD%E7%9A%84%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F%E7%A4%BA%E4%BE%8B"><span class="toc-number">5.2.2.</span> <span class="toc-text">游戏编程中的命令模式示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F%E7%9A%84%E4%BC%98%E7%82%B9"><span class="toc-number">5.2.3.</span> <span class="toc-text">命令模式的优点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">5.2.4.</span> <span class="toc-text">注意事项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.2.5.</span> <span class="toc-text">享元模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.2.6.</span> <span class="toc-text">状态模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%90%E7%B1%BB%E6%B2%99%E7%AE%B1%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.2.7.</span> <span class="toc-text">子类沙箱模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.2.8.</span> <span class="toc-text">工厂模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E5%B7%A5%E5%8E%82"><span class="toc-number">5.2.8.1.</span> <span class="toc-text">函数工厂</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%A3%85%E9%85%8D%E7%B3%BB%E7%BB%9F"><span class="toc-number">6.</span> <span class="toc-text">装配系统</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/03/15/%E6%B8%B8%E6%88%8F%E8%AE%BE%E8%AE%A1/%E6%B8%B8%E6%88%8F%E8%AE%BE%E8%AE%A1/" title="游戏设计"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://files.wujicode.cn/w/open/dnf_universe_app/r4w7VxTy.jpeg&quot;" data-lazy-src="https://files.wujicode.cn/w/open/dnf_universe_app/8n6PdXzn.jpg?_r_=92093b14-daeb-09da-9821-30304a9238ca" onerror="this.onerror=null;this.src='https://files.wujicode.cn/w/open/dnf_universe_app/r4w7VxTy.jpeg'" alt="游戏设计"/></a><div class="content"><a class="title" href="/2025/03/15/%E6%B8%B8%E6%88%8F%E8%AE%BE%E8%AE%A1/%E6%B8%B8%E6%88%8F%E8%AE%BE%E8%AE%A1/" title="游戏设计">游戏设计</a><time datetime="2025-03-15T02:03:30.012Z" title="Created 2025-03-15 10:03:30">2025-03-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/03/15/%E6%9D%82%E9%A1%B9/%E6%B8%B8%E6%88%8F%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/" title="游戏源码解析"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://files.wujicode.cn/w/open/dnf_universe_app/r4w7VxTy.jpeg&quot;" data-lazy-src="https://files.wujicode.cn/w/open/dnf_universe_app/8n6PdXzn.jpg?_r_=eb8d153e-3683-4c8a-2633-3f3ae9065bfe" onerror="this.onerror=null;this.src='https://files.wujicode.cn/w/open/dnf_universe_app/r4w7VxTy.jpeg'" alt="游戏源码解析"/></a><div class="content"><a class="title" href="/2025/03/15/%E6%9D%82%E9%A1%B9/%E6%B8%B8%E6%88%8F%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/" title="游戏源码解析">游戏源码解析</a><time datetime="2025-03-15T02:03:30.008Z" title="Created 2025-03-15 10:03:30">2025-03-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/03/15/%E6%9D%82%E9%A1%B9/%E5%B0%8F%E8%AF%B4/" title="怪物猎人伤害"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://files.wujicode.cn/w/open/dnf_universe_app/r4w7VxTy.jpeg&quot;" data-lazy-src="https://vfiles.gtimg.cn/xy_open/wupload/xy/dnf_universe_app/2RSwZFEA.jpg?_r_=6041c0aa-f459-7e42-bd5e-b8163d779976" onerror="this.onerror=null;this.src='https://files.wujicode.cn/w/open/dnf_universe_app/r4w7VxTy.jpeg'" alt="怪物猎人伤害"/></a><div class="content"><a class="title" href="/2025/03/15/%E6%9D%82%E9%A1%B9/%E5%B0%8F%E8%AF%B4/" title="怪物猎人伤害">怪物猎人伤害</a><time datetime="2025-03-15T02:03:30.005Z" title="Created 2025-03-15 10:03:30">2025-03-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/03/15/%E6%9D%82%E9%A1%B9/%E5%B0%8F%E8%AF%B4%20-%20%E5%89%AF%E6%9C%AC/" title="怪物猎人伤害"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://files.wujicode.cn/w/open/dnf_universe_app/r4w7VxTy.jpeg&quot;" data-lazy-src="https://files.wujicode.cn/w/open/dnf_universe_app/PklBdp0O.jpg?_r_=82e04516-fdc0-0116-c01b-37a4ba91dfb4" onerror="this.onerror=null;this.src='https://files.wujicode.cn/w/open/dnf_universe_app/r4w7VxTy.jpeg'" alt="怪物猎人伤害"/></a><div class="content"><a class="title" href="/2025/03/15/%E6%9D%82%E9%A1%B9/%E5%B0%8F%E8%AF%B4%20-%20%E5%89%AF%E6%9C%AC/" title="怪物猎人伤害">怪物猎人伤害</a><time datetime="2025-03-15T02:03:30.004Z" title="Created 2025-03-15 10:03:30">2025-03-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/03/15/%E6%9D%82%E9%A1%B9/%E4%BC%A4%E5%AE%B3%E8%AE%A1%E7%AE%97/" title="怪物猎人伤害"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://files.wujicode.cn/w/open/dnf_universe_app/r4w7VxTy.jpeg&quot;" data-lazy-src="https://vfiles.gtimg.cn/xy_open/wupload/xy/dnf_universe_app/2RSwZFEA.jpg?_r_=c01413f5-814f-0563-1a88-08dce4410576" onerror="this.onerror=null;this.src='https://files.wujicode.cn/w/open/dnf_universe_app/r4w7VxTy.jpeg'" alt="怪物猎人伤害"/></a><div class="content"><a class="title" href="/2025/03/15/%E6%9D%82%E9%A1%B9/%E4%BC%A4%E5%AE%B3%E8%AE%A1%E7%AE%97/" title="怪物猎人伤害">怪物猎人伤害</a><time datetime="2025-03-15T02:03:30.002Z" title="Created 2025-03-15 10:03:30">2025-03-15</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="footer_deal"><a class="deal_link" href="mailto:anzhiyu-c@qq.com" title="email"><i class="anzhiyufont anzhiyu-icon-envelope"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://weibo.com/u/6378063631" title="微博"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://www.facebook.com/profile.php?id=100092208016287&amp;sk=about" title="facebook"><i class="anzhiyufont anzhiyu-icon-facebook1"></i></a><a class="deal_link" href="/atom.xml" title="RSS"><i class="anzhiyufont anzhiyu-icon-rss"></i></a><img class="footer_mini_logo" title="返回顶部" alt="返回顶部" onclick="anzhiyu.scrollToDest(0, 500)" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://files.wujicode.cn/w/open/dnf_universe_app/r4w7VxTy.jpeg&quot;" data-lazy-src="img/touxiang.jpg" size="50px"/><a class="deal_link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://space.bilibili.com/372204786" title="Bilibili"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://v.douyin.com/DwCpMEy/" title="抖音"><i class="anzhiyufont anzhiyu-icon-tiktok"></i></a><a class="deal_link" href="/copyright" title="CC"><i class="anzhiyufont anzhiyu-icon-copyright-line"></i></a></div><div id="workboard"><img class="workSituationImg boardsign" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://files.wujicode.cn/w/open/dnf_universe_app/r4w7VxTy.jpeg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.0.4/img/badge/安知鱼-上班摸鱼中.svg" alt="距离月入25k也就还差一个大佬带我~" title="距离月入25k也就还差一个大佬带我~"/><div id="runtimeTextTip"></div></div><div id="anzhiyu-footer"><div class="footer-group"><div class="footer-title">服务</div><div class="footer-links"><a class="footer-item" title="51la统计" target="_blank" rel="noopener" href="https://v6.51.la/">51la统计</a><a class="footer-item" title="十年之约" target="_blank" rel="noopener" href="https://www.foreverblog.cn/">十年之约</a><a class="footer-item" title="开往" target="_blank" rel="noopener" href="https://github.com/travellings-link/travellings">开往</a></div></div><div class="footer-group"><div class="footer-title">主题</div><div class="footer-links"><a class="footer-item" title="文档" href="/docs/">文档</a><a class="footer-item" title="源码" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu">源码</a><a class="footer-item" title="更新日志" href="/update/">更新日志</a></div></div><div class="footer-group"><div class="footer-title">导航</div><div class="footer-links"><a class="footer-item" title="即刻短文" href="/essay/">即刻短文</a><a class="footer-item" title="友链文章" href="/fcircle/">友链文章</a><a class="footer-item" title="留言板" href="/comments/">留言板</a></div></div><div class="footer-group"><div class="footer-title">协议</div><div class="footer-links"><a class="footer-item" title="隐私协议" href="/privacy/">隐私协议</a><a class="footer-item" title="Cookies" href="/cookies/">Cookies</a><a class="footer-item" title="版权协议" href="/copyright/">版权协议</a></div></div><div class="footer-group"><div class="footer-title-group"><div class="footer-title">友链</div><a class="random-friends-btn" id="footer-random-friends-btn" href="javascript:addFriendLinksInFooter();" title="换一批友情链接"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right"></i></a></div><div class="footer-links" id="friend-links-in-footer"></div></div></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="博客框架为Hexo_v5.4.0" title="博客框架为Hexo_v5.4.0"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://files.wujicode.cn/w/open/dnf_universe_app/r4w7VxTy.jpeg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Frame-Hexo.svg" alt="博客框架为Hexo_v5.4.0"/></a><a class="github-badge" target="_blank" href="https://blog.anheyu.com/" style="margin-inline:5px" data-title="本站使用AnZhiYu主题" title="本站使用AnZhiYu主题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://files.wujicode.cn/w/open/dnf_universe_app/r4w7VxTy.jpeg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.9/img/Theme-AnZhiYu-2E67D3.svg" alt="本站使用AnZhiYu主题"/></a><a class="github-badge" target="_blank" href="https://www.dogecloud.com/" style="margin-inline:5px" data-title="本站使用多吉云为静态资源提供CDN加速" title="本站使用多吉云为静态资源提供CDN加速"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://files.wujicode.cn/w/open/dnf_universe_app/r4w7VxTy.jpeg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.2.0/img/badge/CDN-多吉云-3693F3.svg" alt="本站使用多吉云为静态资源提供CDN加速"/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" data-title="本站项目由Github托管" title="本站项目由Github托管"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://files.wujicode.cn/w/open/dnf_universe_app/r4w7VxTy.jpeg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Source-Github.svg" alt="本站项目由Github托管"/></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" data-title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://files.wujicode.cn/w/open/dnf_universe_app/r4w7VxTy.jpeg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.2.0/img/badge/Copyright-BY-NC-SA.svg" alt="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"/></a></p></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2025 By <a class="footer-bar-link" href="/" title="凝雨" target="_blank">凝雨</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a><a class="footer-bar-link" target="_blank" rel="noopener" href="https://image.anheyu.com" title="图床">图床</a><a class="footer-bar-link" target="_blank" rel="noopener" href="https://beian.miit.gov.cn/" title="黔ICP备-4204490号">黔ICP备-4204490号</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">Articles</div><div class="length-num">37</div></a><a href="/tags/" title="tag"><div class="headline">Tags</div><div class="length-num">4</div></a><a href="/categories/" title="category"><div class="headline">Categories</div><div class="length-num">8</div></a></div><span class="sidebar-menu-item-title">Function</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="Display Mode"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>Display Mode</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://space.bilibili.com/253251579" title="哔哩哔哩"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://files.wujicode.cn/w/open/dnf_universe_app/r4w7VxTy.jpeg&quot;" data-lazy-src="https://th.bing.com/th?id=ODLS.1e67f861-d980-4c01-ba66-9450f90172f4&amp;w=32&amp;h=32&amp;qlt=96&amp;pcl=fffffc&amp;o=6&amp;cb=15&amp;pid=1.2" alt="哔哩哔哩"/><span class="back-menu-item-text">哔哩哔哩</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://blender.kim/" title="魔酷网"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://files.wujicode.cn/w/open/dnf_universe_app/r4w7VxTy.jpeg&quot;" data-lazy-src="https://th.bing.com/th?id=ODLS.88012746-d99b-4589-a17c-d5eeaad474fd&amp;w=32&amp;h=32&amp;qlt=99&amp;pcl=fffffc&amp;o=6&amp;cb=15&amp;pid=1.2" alt="魔酷网"/><span class="back-menu-item-text">魔酷网</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://www.aplaybox.com/" title="模之屋"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://files.wujicode.cn/w/open/dnf_universe_app/r4w7VxTy.jpeg&quot;" data-lazy-src="https://th.bing.com/th?id=ODLS.221b96bc-0e7f-4f7d-b980-a051789b763b&amp;w=32&amp;h=32&amp;qlt=90&amp;pcl=fffffa&amp;o=6&amp;cb=15&amp;pid=1.2" alt="模之屋"/><span class="back-menu-item-text">模之屋</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://huaban.com/follow" title="花瓣"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://files.wujicode.cn/w/open/dnf_universe_app/r4w7VxTy.jpeg&quot;" data-lazy-src="https://th.bing.com/th?id=ODLS.9e0310ad-0fa0-486f-8c12-81bcf016e199&amp;w=32&amp;h=32&amp;qlt=98&amp;pcl=fffffc&amp;o=6&amp;cb=15&amp;pid=1.2" alt="花瓣"/><span class="back-menu-item-text">花瓣</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://files.wujicode.cn/w/open/dnf_universe_app/r4w7VxTy.jpeg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://www.zhihu.com/people/35-4-25-32" title="知乎"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://files.wujicode.cn/w/open/dnf_universe_app/r4w7VxTy.jpeg&quot;" data-lazy-src="https://th.bing.com/th?id=ODLS.66059014-8637-4840-b8a6-78e2a6e07c34&amp;w=17&amp;h=17&amp;o=6&amp;cb=15&amp;pid=1.2" alt="知乎"/><span class="back-menu-item-text">知乎</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size: 0.9em;"></i><span> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 追番页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/htim/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size: 0.9em;"></i><span> 小空调</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/equipment/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size: 0.9em;"></i><span> 我的装备</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/%E5%8F%98%E9%87%8F/" style="font-size: 0.88rem;">变量<sup>5</sup></a><a href="/tags/%E5%A4%87%E5%BF%98%E5%BD%95/" style="font-size: 0.88rem;">备忘录<sup>1</sup></a><a href="/tags/%E5%AD%A6%E4%B9%A0/" style="font-size: 0.88rem;">学习<sup>35</sup></a><a href="/tags/%E8%84%9A%E6%9C%AC/" style="font-size: 0.88rem;">脚本<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="Switch Between Traditional Chinese And Simplified Chinese">繁</button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Setting"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><button id="go-up" type="button" title="Back To Top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="is-center" id="loading-database"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("15/03/2025 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2025 By 安知鱼 V1.6.14",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 凝雨 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script async="async">(function () {
  var grt = new Date("15/03/2025 00:00:00"); //设置网站上线时间
  var now = new Date();
  var dnum;
  var hnum;
  var mnum;
  var snum;
  var nowHour;

  // 计算并更新天数、小时数、分钟数和秒数
  function updateTime() {
    now = new Date(); // 更新 now 的值
    nowHour = now.getHours(); // 更新 nowHour 的值
    var days = (now - grt) / 1000 / 60 / 60 / 24;
    dnum = Math.floor(days);
    var hours = (now - grt) / 1000 / 60 / 60 - 24 * dnum;
    hnum = Math.floor(hours);
    if (String(hnum).length == 1) {
      hnum = "0" + hnum;
    }
    var minutes = (now - grt) / 1000 / 60 - 24 * 60 * dnum - 60 * hnum;
    mnum = Math.floor(minutes);
    if (String(mnum).length == 1) {
      mnum = "0" + mnum;
    }
    var seconds = (now - grt) / 1000 - 24 * 60 * 60 * dnum - 60 * 60 * hnum - 60 * mnum;
    snum = Math.round(seconds);
    if (String(snum).length == 1) {
      snum = "0" + snum;
    }
  }

  // 更新网页中显示的网站运行时间
  function updateHtml() {
    const footer = document.getElementById("footer");
    if (!footer) return
    let currentTimeHtml = "";
    if (nowHour < 18 && nowHour >= 9) {
      // 如果是上班时间，默认就是"安知鱼-上班摸鱼中.svg"图片，不需要更改
      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    } else {
      // 如果是下班时间，插入"安知鱼-下班啦.svg"图片
      let img = document.querySelector("#workboard .workSituationImg");
      if (img != null) {
        img.src = "https://npm.elemecdn.com/anzhiyu-blog@2.0.4/img/badge/安知鱼-下班啦.svg";
        img.title = "下班了就该开开心心的玩耍，嘿嘿~";
        img.alt = "下班了就该开开心心的玩耍，嘿嘿~";
      }

      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    }

    if (document.getElementById("runtimeTextTip")) {
      document.getElementById("runtimeTextTip").innerHTML = currentTimeHtml;
    }
  }

  setInterval(() => {
    updateTime();
    updateHtml();
  }, 1000);
})();</script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(() => {
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: '',
      region: '',
      onCommentLoaded: () => {
        anzhiyu.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') setTimeout(runFn,0)
    else getScript('https://cdn.cbd.int/twikoo@1.6.39/dist/twikoo.all.min.js').then(runFn)
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: '',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const runFn = () => {
    init();
    
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else {
      loadTwikoo()
    }
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script><script>(() => {
  let initFn = window.walineFn || null

  const initWaline = (Fn) => {
    const waline = Fn(Object.assign({
      el: '#waline-wrap',
      serverURL: '',
      pageview: false,
      dark: 'html[data-theme="dark"]',
      path: window.location.pathname,
      comment: false,
      imageUploader: true,
    }, null))

    const destroyWaline = () => {
      waline.destroy()
    }

    anzhiyu.addGlobalFn('pjax', destroyWaline, 'destroyWaline')
  }

  const loadWaline = async () => {
    if (initFn) initWaline(initFn)
    else {
      await getCSS('https://cdn.cbd.int/@waline/client@3.1.3/dist/waline.css')
      if (false) await getCSS('https://cdn.cbd.int/@waline/client@3.1.3/dist/waline-meta.css')
      const { init } = await import('https://cdn.cbd.int/@waline/client@3.1.3/dist/waline.js')
      initFn = init || Waline.init
      initWaline(initFn)
      window.walineFn = initFn
    }
  }

  if ('Twikoo' === 'Waline' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('waline-wrap'),loadWaline)
    else setTimeout(loadWaline, 0)
  } else {
    window.loadOtherComment = loadWaline
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[image]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[link]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[code]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    const runTwikoo = () => {
      twikoo.getRecentComments({
        envId: '',
        region: '',
        pageSize: 6,
        includeReply: true
      }).then(function (res) {
        const twikooArray = res.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.id,
            'date': new Date(e.created).toISOString()
          }
        })

        saveToLocal.set('twikoo-newest-comments', JSON.stringify(twikooArray), 10/(60*24))
        generateHtml(twikooArray)
      }).catch(function (err) {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "Unable to get the data, please make sure the settings are correct."
      })
    }

    if (typeof twikoo === 'object') {
      runTwikoo()
    } else {
      getScript('https://cdn.cbd.int/twikoo@1.6.39/dist/twikoo.all.min.js').then(runTwikoo)
    }
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'><div class='name'><span>${array[i].nick} </span></div></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div>`
      }
    } else {
      result += 'No Comment'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('twikoo-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script async data-pjax src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.1/bubble/bubble.js"></script><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","meta[property=\"og:type\"]","meta[property=\"og:site_name\"]","meta[property=\"og:description\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>